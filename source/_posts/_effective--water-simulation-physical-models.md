---
title: 第一章 基于物理模型对水波进行模拟
date: 2020-12-4 19:88:00
categories:
- [Unity, Shader, Wave]
tags:
- Shader
- Water
- Wave
---

本文讲述如何使用Shader渲染大面积水体波纹。本文结合网格变形和动态法向贴图来实现的。所生成的水体适合实时游戏场景，Cyan Worlds的 Uru: Ages Beyond Myst 就采用了这种方法：
![](https://developer.nvidia.com/sites/all/modules/custom/gpugems/books/GPUGems/elementLinks/fig01-01.jpg)

## 1.1 波的物理模型

波，是通过周期震荡的向外界传递能量的一种表现形式。正弦函数是波的常见几何形态。而波是随着空间和时间的不同，其所处的状态也不同，因此波可以描述为时间和空间的函数。如下图所示：

![](https://developer.nvidia.com/sites/all/modules/custom/gpugems/books/GPUGems/elementLinks/fig01-02.jpg)
图 1
在描述波时，我们通常可以从波长、振幅、频率、周期、传播速度、传播方法几个维度讨论。
对照上图 1， 这几个参数可以描述为：
	
	L：波长
	F：与波长相关的角速度
	A: 振幅
	S: 传播速度
	W: 震荡角速度
	T：震荡周期
	D: 传播方向(这里是沿着水平方向，但是在真实水面上是有两个维度的)
	
### 1.1.1 那么这些参数是如何表示波的呢？

首先看图 1中的w(x,y,t)两个波锋，当时间处于t时刻时，第一个波峰处在当前位置，当时间处于`t+T`时刻时，第一个波峰再次出现，但是从视觉上看，等价于第一个波峰传递到第二个波锋。因此可以得出：

	L = ST	(1) 

当时间处于`t+T`时刻时，第一波峰再次出现，说明：

	WT = 2PI (2)
	
前面两个等式都是基于时间变化得出来的，单个点垂直震荡遵循正弦函数规律。我们从空间角度来看，波型本身也遵循正弦函数规律，因此有：

	FL = 2PI (3)

对于水面某个点点P(x,y,z)从时间上来看，波函数有：

	y = A * Sin( W * t ) (4)

从空间上来看有：

	y = A * Sin( F * Dxz * Pxz ) (5)
	
综合以上等式有：
	
	w(x,z,t) = y = A * Sin( F * Dxz * Pxz + W * t ) (6)

其中：

	F = 2PI／L       (7)
	W = S * 2PI/L    (8)
	
结合(6)(7)(8)三个等式，我们可以通过，波长、振幅、传播速度、传播方向、时间、空间点来精确描述波形。但是在代码中，基于优化考虑，我们通常是先在CPU中先计算好F、W两个参数，然后在GPU中可以减少运算量。

### 1.1.2 混合波

通常情况下，水面波纹是纵横跌宕，因此需要多个波型混合来实现相应效果。混合后的波型函数为：

	h(x,z,t) = y = E( Ai * Sin ( Fi * Dxzi * Pxz + t * Wi ) (9)

其中E为求和函数。
















	