<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blogs/images/girl_180_0.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blogs/images/girl_32_0.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blogs/images/girl_16_0.png">
  <link rel="mask-icon" href="/blogs/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blogs/css/main.css">


<link rel="stylesheet" href="/blogs/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tyson-wu.github.io","root":"/blogs/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="If you want, Just do it!">
<meta property="og:type" content="website">
<meta property="og:title" content="TysonWu&#39;s Blog">
<meta property="og:url" content="https://tyson-wu.github.io/blogs/page/6/index.html">
<meta property="og:site_name" content="TysonWu&#39;s Blog">
<meta property="og:description" content="If you want, Just do it!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Tyson Wu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tyson-wu.github.io/blogs/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>TysonWu's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blogs/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">TysonWu's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">AiCooXiao</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blogs/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blogs/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blogs/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blogs/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blogs/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/06/29/Ronja_HLSL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/06/29/Ronja_HLSL/" class="post-title-link" itemprop="url">HLSL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-29 11:01:00" itemprop="dateCreated datePublished" datetime="2021-06-29T11:01:00+08:00">2021-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/Shader/" itemprop="url" rel="index"><span itemprop="name">Shader</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文：<br><a target="_blank" rel="noopener" href="https://www.ronja-tutorials.com/post/002-hlsl/">HLSL</a></p>
<h2 id="HLSL？"><a href="#HLSL？" class="headerlink" title="HLSL？"></a>HLSL？</h2><p>HLSL是Unity着色器中所使用的一种语言，可以通过HLSL来实现渲染逻辑。HLSL语言是微软设计的、面向D3D的GPU编程语言。严格的说，网络上现有的大多数Unity着色器脚本是通过CG语言编写的，CG是C for Graphics的简写，也就是为图形编辑而设计的C语言。但是CG语法和HLSL有很多共性，同时CG语言在2012年便不再维护，而我们很容易把两者混淆，不过这并不影响我们进一步的学习。理论上，Unity也支持GLSL语言，GLSL是为OpenGL设计的编程语言，也是类C的编程语言。由于HLSL的例子在网络上随处可见，同时Unity会根据平台不同，自动会将着色器脚本翻译为对应的语言，所以我们不必纠结使用哪种语言。为了方便，这里建议直接使用HLSL语言。</p>
<p>因为着色器编程难度较大，所以建议初学者在系统学习过基本的编程，再考虑学习着色器编程。因为着色器脚本是在GPU中运行的，而一般的编辑软件是在CPU中运行，所以在着色器编程过程中，很难进行异常分析。因此这也导致我们开发过程中有很多限制，另外，和普通的软件开发相比，我们需要从不同的角度来思考问题。如果你已经具备了基本的编程素养，知道什么是数据类型、类、函数、循环、条件语句等，也大概知道CPU和GPU的区别、串行与并行的区别，那么欢迎你阅读下面的内容。</p>
<h2 id="Builting-Types"><a href="#Builting-Types" class="headerlink" title="Builting Types"></a>Builting Types</h2><p>首先，我们需要知道在着色器编写过程中，有哪些可以使用的内置数据类型。</p>
<h3 id="Scalar-Values"><a href="#Scalar-Values" class="headerlink" title="Scalar Values"></a>Scalar Values</h3><p>标量。在Unity的hlsl语言中，小数的类型有<code>fixed</code>、<code>half</code>、以及<code>float</code>，整形的类型有<code>int</code>、<code>uint</code>。需要指出的是，在最新的URP渲染管线中，小数的类型只支持<code>half</code>、和<code>float</code>。</p>
<p>在移动端的GPU中，<code>fixed</code>的数据范围为<code>[-2, 2]</code>，其精度为<code>1/256</code>。而<code>half</code>和<code>float</code>分别是16位和32位的浮点数。在PC端的GPU中，这三类都是32位浮点数。所以在后面的内容中，你将会看到我基本上都是使用<code>float</code>来表示小数，当然，后面有工具可以对此进行优化。</p>
<p>整形，也就是我们所知的整数，其中<code>int</code>可以是正数也可以是负数，而<code>uint</code>只能是正数，这两者之间合理的选择，也能达到细微的优化作用。</p>
<p>另外，还支持<code>bool</code>类型，布尔类型数据用于表示是与否的两种状态。如果我们强行将布尔和数值进行加减乘除运算时，那么实际的布尔值的是就变成1、而否就变成0参与计算。</p>
<h3 id="Vector-Values"><a href="#Vector-Values" class="headerlink" title="Vector Values"></a>Vector Values</h3><p>向量。向量在空间上表示的是一个方向，由各个维度的投影分量构成。上提到的标量，从广义上来说是一维向量。向量在HLSL中的表示很简单，只要在上面对应标量的后面加上维度。例如上面的<code>fixed</code>、<code>half</code>、<code>float</code>的四维向量分别是<code>fixed4</code>、<code>half4</code>、<code>float4</code>。向量的使用很常见，例如记录纹理坐标、颜色、位置等信息。</p>
<p>当然，我们也可以访问向量中特定维度的分量。以4维向量v为例，向量数据是一个长度为4的数组，起始索引为0。也就是说v[0]实际上就是访问的第一个维度的值。另外，向量在着色器中主要用于表示空间、和颜色。所以为了方便，可以直接通过维度名称来索引，例如获取x轴的分量可以表示为v.x，获取红色通道的值可以表示为v.r。这些维度、通道的数据就是存储在前面所说的数组中，其顺序为xyzw、和rgba。换句话说，v[0]、v.x、v.r访问的是同一个值。</p>
<p>另外，在实际使用中，我们可能经常遇到需要从一个向量中选取部分值，来重新构成一个新的向量。因此HLSL在语言设计时就引入了这种通过维度、或通道混合的方式来实现向量重构。举个例子：</p>
<ul>
<li>v.xy  ： 选取原向量中的前两个维度，构成一个新的二维向量；</li>
<li>v.zyx ： 选取原向量中的前三个维度，并且调换顺序，构成一个新的三维向量；</li>
<li>v.xxxx:  选取原向量中的第一个维度，构成一个四维向量，新构成的四维向量的各个维度的值都等于原向量中的第一个维度的值；</li>
</ul>
<h3 id="Matrix-Values"><a href="#Matrix-Values" class="headerlink" title="Matrix Values"></a>Matrix Values</h3><p>矩阵。如果说前面的向量是在标量的基础上，朝着一个方向扩展。那么矩阵就是朝着两个方向扩展，分别是横向r、和纵向c。因此矩阵的数据结构是一个二维数组，与标量对应的表示有<code>fixedrxc</code>、<code>halfrxc</code>、<code>floatrxc</code>，其中的r和c表示的是行数和列数。例如<code>float4x4</code>、<code>half3x2</code>、<code>bool2x4</code>。和向量类型，矩阵也可以使用二维数组的方式进行访问，例如<code>matrix[3][2]</code>，访问的是矩阵中第3行、第2列的元素，注意，这里的行号和列号都是从0开始的。除了二维数组的访问方式，还可以使用元素名称进行访问，例如_m32是第3行、第2列的名称。还可以使用名称混合的方式，实现向量重构。例如matrix._m03_m13_m23，是选取矩阵最后一列的前三个元素构成一个三维向量。如果我们采用二维数组的访问方式，但是只传入一个索引号，那么这个索引号表示的是行号，得到的是该行的向量。例如matrix[0]表示的是获取第0行的向量。</p>
<p>矩阵处理非常繁琐，庆幸的是我们很少会需要去单独处理其中的元素，因此可以直接调用现有的辅助函数来实现矩阵运算。</p>
<h3 id="Textures"><a href="#Textures" class="headerlink" title="Textures"></a>Textures</h3><p>HLSL同时也定义了纹理类型。纹理类型比较特殊，这里不做过多讲述，只需要知道，我们可以通过<code>tex2D(texture, coordinate)</code>来对纹理进行采样。当然，在后面的内容我们会了解跟多，I Promise!</p>
<h2 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h2><p>在数学计算方面，HLSL提供基本的操作方法，例如<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>，可以执行基本的数值计算，而<code>&lt;</code>、<code>&gt;</code>、<code>==</code>、<code>!=</code>、<code>!</code>、<code>&gt;=</code>、<code>&lt;=</code>、<code>&amp;&amp;</code>、<code>||</code>可以用于条件比较。除此之外，HLSL还集成了像<code>abs</code>、<code>dot</code>、<code>lerp</code>、<code>pow</code>、<code>min</code>、<code>atan2</code>等常用函数，详情可参考<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-intrinsic-functions">这里</a>。</p>
<p>同时，HLSL也提供一些快捷操作符，例如<code>+=</code>、<code>*=</code>、<code>-=</code>、<code>/=</code>，这些在将操作符左右两边的数据除了后，复值给左边的数据。还有<code>++</code>、<code>--</code>可以用于自增、自减一个单位。</p>
<p>需要注意的是，标量和向量的乘法，是标量乘以向量中的每一个元素，然后生成一个同维度的向量。例如<code>float2(2,7) * 3 == float2(6, 21)</code>。</p>
<p>而矩阵与向量的乘积相对复杂点，在矩阵分析中有介绍，不过直观的理解就是矩阵表示空间坐标系之间的关系，而向量表示空间坐标系中的点、或方向，两者乘积的结果表示向量从一个空间变换到另一个空间。在应用过程中，我们并不太关系该操作的具体实现。初学者可以基于这种直观理解，然后参考模仿现有的应用案例，或者直接从中复制过来，久而久之就知道怎么用了。矩阵向量的乘积使用的函数是<code>mul</code>，具体可以参考<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-mul">这里</a>。</p>
<h2 id="Custom-Types"><a href="#Custom-Types" class="headerlink" title="Custom Types"></a>Custom Types</h2><p>除了内置类型，我们还可以添加一些自定义类型。自定义类型的语法和类C语言的结构体很像，但是需要注意的是，必须在自定义类型后面加上分号<code>;</code>。如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">typeName</span>&#123;</span></span><br><span class="line">  <span class="keyword">float</span> variable;</span><br><span class="line">  float2 otherVariable;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>理论上来说，我们也可以使用<code>class</code>关键字、继承、成员函数、甚至是接口类型。但是，目前为止，我只看到使用<code>struct</code>的情况，所以我们依照祖传习惯就好。如果你想做第一个吃螃蟹的人，那么你可以试着将<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/overviews-direct3d-11-hlsl-dynamic-linking-class">这些</a>类C的语法应用上去，能不能正常使用，就全看天意了:-&gt;!</p>
<p>和向量类似，如果我们想访问自定义结构中的成员变量，同样是采用<code>.</code>连接符。例如，instance.variable，或者可以访问成员的成员，如，instance.otherVariable.x。</p>
<h2 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h2><p>变量。在HLSL中，所有的数据都是值类型，这意味着所有操作，都是直接作用在变量上，而不是变量的引用。同时，我们也不需要使用<code>new</code>之类的关键字来创建变量。</p>
<p>当我们希望创建一个向量时，只需要把向量类型当做普通函数调用就可以。例如创建四维向量<code>float4()</code>、<code>float4(1,1,1,1)</code>。在这种情况下，创建向量的所有参数的维度总和，必须等于目标向量的维度。例如创建一个四维向量，可以传入四个标量，也可以传入两个二维向量，还可以传入两个标量加一个二维向量，或者直接传入一个四维向量。如下，以上面的自定义结构为例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typeName instance;</span><br><span class="line">instance.variable = <span class="number">3.14</span>;</span><br><span class="line">instance.otherVariable = float2(<span class="number">3</span>, <span class="number">1.4</span>);</span><br></pre></td></tr></table></figure>

<p>另外，变量可以声明在函数内、和函数外。如果定义在函数内，那么能在函数内可以使用，并且使用的位置必须在定义之后。如果定义在函数外面，那么所有的函数都可以使用这个变量，不受顺序的影响，但是习惯上我们会将变量统一定义在函数之前。</p>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>在HLSL中，大多是函数都是全局函数。这意味着它们不属于任何数据结构，并且我们可以在任何位置调用它们。这些函数可以传入一个或多个参数，还可以返回计算结果。如果你不希望函数返回任何值，那么你可以在前面声明为<code>viod</code>。如下是一个函数范例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">returnType <span class="title">functionName</span><span class="params">(argType arg1, otherArgType arg2)</span></span>&#123;</span><br><span class="line">  <span class="comment">//在这里实现函数功能逻辑</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> returnValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们调用函数的时候，只需要写下函数名，以及后面跟的括号。如果函数接受传参的话，直接将所需参数以逗号分隔，依次写在括号内。这里的函数支持重载，函数和其参数共同构成了该函数的唯一标识，所以我们可以定义多个同名、但不同参的函数体。在调用时，程序会自动根据传入参数来判断所调用的函数。</p>
<h2 id="Control-Flow"><a href="#Control-Flow" class="headerlink" title="Control Flow"></a>Control Flow</h2><p>对于大多是着色器，我们只需要一行接一行的执行相关逻辑，就可以实现我们想要的功能。但是有些复杂点的需求，我们可能需要重复执行某些命令，或者需要丢弃某些命令，这就涉及到代码执行路径选择的问题。在程序上这叫分支语句、或者叫条件语句，还有循环语句。很多人认为，使用分支语句会影响着色器的执行效率，尤其是移动端，所以应该使用<code>step</code>来代替分支语句。这中说法显然不对，因为在<code>step</code>这类函数中本身就是基于分支语句实现的。而且使用<code>step</code>这些函数会使我们程序在逻辑上变得复杂，不利于阅读。当然，上面关于执行效率的说法并不是完全没有依据，假如我们使用分支语句，刚好GPU会执行所有路径，然后丢弃其中一条路径的计算结果，这时候确实存着资源浪费。但是这并不能通过其他技术来避免，毕竟有些逻辑本身就存在分支，所以不要下意识的排斥使用条件语句，而应该多考虑代码的整体结构，是否美观、是否易于阅读。</p>
<h3 id="if-statements"><a href="#if-statements" class="headerlink" title="if statements"></a>if statements</h3><p>如下所示的<code>if</code>语句，如果条件为<code>true</code>，那么执行上半部分的逻辑，否则，执行下半部分的逻辑。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)&#123;</span><br><span class="line">  <span class="comment">//条件为true，执行这里</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//条件为false，执行这里</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的<code>else&#123;...&#125;</code>部分是可选的。花括号中的逻辑相当于一个整体。如果我们不使用花括号，那么上面的条件语句只会将其后的一行逻辑代码当成它的分支。上面的<code>condition</code>值可以是<code>bool</code>、或<code>int</code>，也可以是一条语句，但是这条语句的结果必须是前面两者之一。另外，<code>!</code>可以用于逻辑取反，假设我们希望条件为<code>false</code>时执行<code>if</code>后的分支，那么只需要在条件之前加<code>!</code>。</p>
<h3 id="Loops"><a href="#Loops" class="headerlink" title="Loops"></a>Loops</h3><p>除了分支语句，还有另外一种常见的控制流-循环语句。<code>While</code>循环是最简单的循环语句，如果条件为<code>ture</code>时，它将会一直循环下去，直到条件为<code>false</code>为止。如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(condition)&#123;</span><br><span class="line">  <span class="comment">//执行循环逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有一点要记住，在<code>while</code>循环语句中，必须要有某一段可执行代码来将条件置为<code>false</code>，如果没有这种代码，那么该循环将会一直执行下去，这是非常严重的问题。</p>
<p>另一种循环叫做<code>for</code>循环，在<code>for</code>循环中可以假如控制循环次数的变量。如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(beforeLoopLogic; condition; inLoopLogic)&#123;</span><br><span class="line">  <span class="comment">//执行循环逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for</code>循环下循环次数控制方便面，显得更加简单明了。比如从0开始到最大次数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(uint index=<span class="number">0</span>;index&lt;maxValue;index++)&#123;</span><br><span class="line">  <span class="comment">//执行循环逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，我们也可以使<code>while</code>循环来实现同样的功能，但是看起来就没有<code>for</code>循环那么整洁了：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uint index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(index &lt; maxValue)&#123;</span><br><span class="line">  <span class="comment">//执行循环逻辑</span></span><br><span class="line"></span><br><span class="line">  index++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有的循环语句中都支持<code>break</code>和<code>continue</code>关键字。其中<code>break</code>用于中断循环语句，直接跳出循环。而<code>continue</code>是跳过本次循环，但是会继续执行后续的循环。</p>
<p>好了，本篇终结！希望你能喜欢我的教程。如果你想支持我，可以关注我的<a target="_blank" rel="noopener" href="https://twitter.com/totallyRonja">推特</a>,或者通过<a target="_blank" rel="noopener" href="https://ko-fi.com/ronjatutorials">ko-fi</a>、或<a target="_blank" rel="noopener" href="https://www.patreon.com/RonjaTutorials">patreon</a>给两小钱。总之，各位大爷，走过路过不要错过，有钱的捧个钱场，没钱的捧个人场:-)!!!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/06/25/Ronja_Structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/06/25/Ronja_Structure/" class="post-title-link" itemprop="url">Structure of Shader</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-25 11:01:00" itemprop="dateCreated datePublished" datetime="2021-06-25T11:01:00+08:00">2021-06-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/Shader/" itemprop="url" rel="index"><span itemprop="name">Shader</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文：<br><a target="_blank" rel="noopener" href="https://www.ronja-tutorials.com/post/001-structure/">Structure</a></p>
<h2 id="Shader-Structure"><a href="#Shader-Structure" class="headerlink" title="Shader Structure"></a>Shader Structure</h2><p>着色器编程难度较大，在学习初期阶段，我们首先需要学习它的基本结构，以便于后面灵活的修改、应用它们。</p>
<p>现代着色器采用的是可变渲染管线，其中顶点着色器、和片段着色器是其基本组成。除此之外，还有可选部分，几何着色器、曲面细分着色器，但是它们的应用场景比较少。顶点着色器的作用是将模型网格，通过矩阵变换，投影到屏幕(实际是投影到裁剪空间)。同时，顶点着色器的一个非常有用的操作是，执行顶点动画。当顶点坐标变换到屏幕空间后，其所构成的三角面片将被栅格化。为了保证三角面片能够正确显示，从顶点着色器到片段着色器的过程中，需要对顶点进行插值，从而得到三角面片中各个片段的位置、颜色值等。<br><img src="https://www.ronja-tutorials.com/assets/images/posts/001/pipeline.png"></p>
<p>上面简单介绍了着色器的基本流程。接下来我将阐述如何编写着色器、这些“空间坐标系”的具体含义、不同着色器之间的数据传递。但是，我相信了解其基本流程，有助于我们对着色器不同阶段之间的关系有一个直观的理解。因为，在大多数着色器语言中，基本采用了这种基本流程。即便是那些更为高级的、可以通过节点拼接的着色器语言，最终也是将其翻译为这种基本流程。</p>
<h2 id="ShaderLab"><a href="#ShaderLab" class="headerlink" title="ShaderLab"></a>ShaderLab</h2><p>在Unity中，着色器实际上就是一个以<code>.shader</code>结尾的文本文件。我们可以在资源面板下，依次选择<code>Create &gt; Shader &gt;</code>中的着色器模板，当然模板中的内容可能并不是我们想要的，不过没关系，下面我将介绍如何自定义着色器。为了易于上手，这里我以模板着色器<code>Create &gt; Shader &gt; Unlit</code>为参考，编写我们自己的着色器。当然这里我写的和<code>Unlit</code>之间最大的区别在于，我们这个是不会处理雾效，同时又增加了一个颜色属性，这样可以从整体对模型颜色进行调整。接下来我也会一步一步的讲解其实现逻辑。本教程目标是着色器小白，所以你如果有哪里不理解的地方，可以告诉我，促使我对其进行调整，以便于后续学习者能够更加顺畅。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Tutorial/001-004_Basic_Unlit&quot;</span>&#123;</span><br><span class="line">	<span class="comment">//这些值将会显示在材质面板上</span></span><br><span class="line">	Properties&#123;</span><br><span class="line">		_Color (<span class="string">&quot;Tint&quot;</span>, Color) = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">		_MainTex (<span class="string">&quot;Texture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span> &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SubShader&#123;</span><br><span class="line">		<span class="comment">//当前的标签设置表示的是：不透明渲染，和其他不透明物体处以同一渲染队列</span></span><br><span class="line">		Tags&#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> <span class="string">&quot;Queue&quot;</span>=<span class="string">&quot;Geometry&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">		Pass&#123;</span><br><span class="line">			CGPROGRAM</span><br><span class="line"></span><br><span class="line">			<span class="comment">//这里包括一些工具函数、以及内置变量</span></span><br><span class="line">			<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//定义顶点、片段着色函数</span></span><br><span class="line">			<span class="meta">#<span class="meta-keyword">pragma</span> vertex vert</span></span><br><span class="line">			<span class="meta">#<span class="meta-keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//材质所用的纹理、以及缩放偏移量</span></span><br><span class="line">			sampler2D _MainTex;</span><br><span class="line">			float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//材质的颜色，具体一点是：当纹理为白色图片时，材质的颜色</span></span><br><span class="line">			fixed4 _Color;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//模型网格、UI等输入数据，基本代表了模型内在属性</span></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> <span class="title">appdata</span>&#123;</span></span><br><span class="line">				float4 vertex : POSITION;</span><br><span class="line">				float2 uv : TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//当经过顶点着色器处理后，处理的数据经过栅格化插值，然后传入片段着色器</span></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> <span class="title">v2f</span>&#123;</span></span><br><span class="line">				float4 position : SV_POSITION;</span><br><span class="line">				float2 uv : TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//顶点着色器函数，主要执行坐标的空间变换</span></span><br><span class="line">			<span class="function">v2f <span class="title">vert</span><span class="params">(appdata v)</span></span>&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				<span class="comment">//将模型各顶点坐标，转换到裁剪空间</span></span><br><span class="line">				o.position = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				<span class="comment">//基于图片的缩放偏移参数，对UV进行变换</span></span><br><span class="line">				o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span><br><span class="line">				<span class="keyword">return</span> o;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//片段作色器，主要是计算像素点的颜色</span></span><br><span class="line">			<span class="function">fixed4 <span class="title">frag</span><span class="params">(v2f i)</span> : SV_TARGET</span>&#123;</span><br><span class="line">			    <span class="comment">//基于UV坐标，进行纹理采样</span></span><br><span class="line">				fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class="line">				<span class="comment">//将纹理颜色和材质颜色相乘</span></span><br><span class="line">				col *= _Color;</span><br><span class="line">				<span class="comment">//返回最终的像素点颜色</span></span><br><span class="line">				<span class="keyword">return</span> col;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	Fallback <span class="string">&quot;VertexLit&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Whats-ShaderLab"><a href="#Whats-ShaderLab" class="headerlink" title="Whats ShaderLab?"></a>Whats ShaderLab?</h2><p><code>Shaderlab</code>是Unity内置的着色器语言，其中定义了绝大多数渲染模型所需的数据。但是着色器执行渲染逻辑的部分，实际上是采用<code>hlsl</code>、<code>glsl</code>、<code>CG</code>这三种着色语言中的一种。这里<code>hlsl</code>是微软开发的底层着色器语言，<code>glsl</code>是英伟达开发的底层着色器语言，<code>CG</code>是更为高级的作色器语言。而这些执行部分在<code>Shaderlab</code>中占有一个独立的区域。具体一点，<code>Shaderlab</code>是在执行<code>hlsl</code>、<code>glsl</code>、<code>CG</code>的基础上，扩展了一些属于自身的语法，其中包括<code>Properties</code>属性块，用来关联外部输入参数。<br><img src="https://www.ronja-tutorials.com/assets/images/posts/002/LanguageAreas.png"></p>
<p>从上图可以看到，实际<code>ShaderLab</code>扩展的仅占着色器很小区域。其中一部分原因是：<code>Shaderlab</code>不是可执行语言，而是一种抽象的描述性语言，定义了着色器有哪些输入参数、需要执行哪些渲染操作。而Unity便会识别这些描述性语言，然后将其翻译为GPU可执行的作色器语言，同时关联渲染所需的数据。对于一些简单的渲染需求，参考上图的例子，然后对<code>CG</code>部分进行简单的调整就行了。</p>
<h2 id="Shader-SubShader-Pass"><a href="#Shader-SubShader-Pass" class="headerlink" title="Shader/SubShader/Pass"></a>Shader/SubShader/Pass</h2><p>在上图中，你可能也发现了，其中有很多个<code>&#123;&#125;</code>花括号，将程序分为很多个块。下面我们来看看，这些块到底是干嘛的。</p>
<p>首先，最外层的<code>Shader</code>块，代表了整个作色器。在我们创建材质球后，需要在材质球面板上选择所需的着色器，从而得到我们所需的材质球。那些在材质面板上的着色器名称，实际上就是紧跟在<code>Shader</code>块后面的字符串。在这个字符串中，我们可以使用<code>/</code>反斜杠来对着色器进行有效的组织分类，这很像我们文件目录的组织形式。在本教程中，我将所有的着色器划分到<code>Tutorial</code>这个大类中，其中还会细分出一些小类。当然，这些分类可以根据需要随意改动，只要达到有效组织的目的就行。<br>可以看到，所谓的着色器，实际上也就是一连串描述的文本文件。需要注意的是，一个文本文件，只能定义一个着色器。但是，一个着色器却可以复用另一个着色器的功能。例如，在<code>Shader</code>块中，也就是最外层花括号中，我们可以定义<code>fallback shader</code>，当Unity将其翻译为更底层的着色器代码时，会将<code>fallback shader</code>中的<code>SubShader</code>块复制过来。</p>
<p>在<code>Shader</code>块中，可以定义多个<code>SubShader</code>块。在模型渲染时，只会从中选择一个<code>SubShader</code>来执行，而具体选择哪个，依赖于实际运行的平台。可惜的是，关于如何定义<code>SubShader</code>的说明文档极其匮乏，根据我多年的经验，在很多情况下，一个<code>Shader</code>块中只定义一个<code>SubShader</code>能满足基本需求，减少很多不必要的麻烦。凡事皆有特例，当我们想实现阴影效果时，需要在当前<code>SubShader</code>块中实现相应的<code>ShadowPass</code>，每次都实现一遍很麻烦。因为阴影着色流程基本固定，所以Unity提供的现成的便可以使用，这时候，我们可以使用包含阴影着色逻辑的<code>fallback shader</code>，当渲染时，从该<code>SubShader</code>中未找到可以使用的<code>ShadowPadd</code>时，便会从<code>fallback shader</code>中去查找。大多数情况下，我们使用<code>VertexLit</code>着色器，来作为我们的<code>fallback shader</code>，因为<code>VertexLit</code>中的逻辑简单、性能消耗低、基本上能够兼容所有的显卡，也可能是大家相互Copy，从而形成<code>VertexLit</code>流行的假象:-)。另外，在<code>SubShader</code>块中，我们可以定义<a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/SL-SubShaderTags.html">Subshader tags</a>；还可以定义多个<code>Pass</code>，例如前面说的<code>Shadow pass</code>；以及属性，在<code>SubShader</code>块中定义的属性是由所有<code>Pass</code>共享的。</p>
<p>一个<code>Pass</code>包含一套完整的渲染流程，从底层着色语言的角度来看，一个<code>Pass</code>才是实际上的着色器，它将模型数据转换为五彩斑斓的画面。在内置渲染管线中，如果我们在<code>SubShader</code>块中定义了多个<code>Pass</code>，当该<code>SubShader</code>被平台选定时，其中的<code>Pass</code>将会被一个接着一个的执行(而最新的URP渲染管线，目前仅支持单个光照<code>Pass</code>)。对于具有多个<code>Pass</code>的<code>SubShader</code>，我们可以将其公共属性等数据定义在<code>SubShader</code>中，而<code>Pass</code>中定义一些独有的数据或逻辑。</p>
<h2 id="Properties-and-Tags"><a href="#Properties-and-Tags" class="headerlink" title="Properties and Tags"></a>Properties and Tags</h2><p>你们可能注意到，在上图中还有两个块<code>Properties</code>、<code>Tags</code>未被提及，那我们继续吧。</p>
<p>在很多编程语言中有字典的概念，顾名思义，就是类似汉语字典一样，可以通过拼音、笔画等关键信息进行快速检索。这里的<code>Tags</code>就可以类比到字典，在<code>Tags</code>中可以定义多个关键字，以及关键字所对应的值，它们公共构成了着色器的配置参数。其中关键字表示了参数的类型，值表示了参数的实际设置。在<code>SubShader</code>中，可以通过<code>Tags</code>定义着色器的材质表现、渲染顺序、以及其他操作；而<code>Pass</code>中的<code>Tags</code>主要定义了光照模式。详细的说明可以参考<a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/SL-SubShaderTags.html">SubShader Tags</a>和<a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/SL-PassTags.html">Pass Tags</a>。</p>
<p><code>Properties</code>属性块，主要用来定义材质面板中的属性显示。通过材质面板来调整材质参数具有一定的局限性，因为整个调整是以材质球为单位，也就是说，如果多个模型使用同一个材质球，那么就无法做到材质差异化。这时候需要创建多个材质球，分别对应于不同的模型。在接下来得教程中我也会详细讨论<code>Properties</code>的使用。</p>
<p>下面我们对<code>Shaderlab</code>的基本结构进行一个总结：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Category/Name&quot;</span>&#123;</span><br><span class="line">	Properties&#123;</span><br><span class="line">		<span class="comment">//用于材质面板显示、与配置的属性</span></span><br><span class="line">	&#125;</span><br><span class="line">	Subshader&#123;</span><br><span class="line">		Tags&#123;</span><br><span class="line">			<span class="comment">//一些公共配置，涉及渲染类型、渲染顺序等设置</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//公共设置、属性、方法可以写在Subshader中</span></span><br><span class="line"></span><br><span class="line">		Pass&#123;</span><br><span class="line">			Tags&#123;</span><br><span class="line">				<span class="comment">//主要是光照模式的配置</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//单个Pass的设置， 例如剔除、模板等</span></span><br><span class="line"></span><br><span class="line">			CGPROGRAM</span><br><span class="line">			<span class="comment">//实际执行的渲染程序、以及所用到的属性参数</span></span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>所有的教程都有配套源码，可以在教程结尾找到相关链接。因为目前我只是做了一些简单的分析介绍，所有源码在上面已经出现过了，这里直接简单的整理一下。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/001-004_basic_unlit/basic_unlit.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/001-004_basic_unlit/basic_unlit.shader</a></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Tutorial/001-004_Basic_Unlit&quot;</span>&#123;</span><br><span class="line">	<span class="comment">//这些值将会显示在材质面板上</span></span><br><span class="line">	Properties&#123;</span><br><span class="line"><span class="comment">//	_Color (&quot;Tint&quot;, Color) = (0, 0, 0, 1)</span></span><br><span class="line"><span class="comment">//	_MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SubShader&#123;</span><br><span class="line">		<span class="comment">//当前的标签设置表示的是：不透明渲染，和其他不透明物体处以同一渲染队列</span></span><br><span class="line">		Tags&#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> <span class="string">&quot;Queue&quot;</span>=<span class="string">&quot;Geometry&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">		Pass&#123;</span><br><span class="line">			CGPROGRAM</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//这里包括一些工具函数、以及内置变量</span></span><br><span class="line"><span class="comment">//		#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//定义顶点、片段着色函数</span></span><br><span class="line"><span class="comment">//		#pragma vertex vert</span></span><br><span class="line"><span class="comment">//		#pragma fragment frag</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//材质所用的纹理、以及缩放偏移量</span></span><br><span class="line"><span class="comment">//		sampler2D _MainTex;</span></span><br><span class="line"><span class="comment">//		float4 _MainTex_ST;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//材质的颜色，具体一点是：当纹理为白色图片时，材质的颜色</span></span><br><span class="line"><span class="comment">//		fixed4 _Color;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//模型网格、UI等输入数据，基本代表了模型内在属性</span></span><br><span class="line"><span class="comment">//		struct appdata&#123;</span></span><br><span class="line"><span class="comment">//			float4 vertex : POSITION;</span></span><br><span class="line"><span class="comment">//			float2 uv : TEXCOORD0;</span></span><br><span class="line"><span class="comment">//		&#125;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//当经过顶点着色器处理后，处理的数据经过栅格化插值，然后传入片段着色器</span></span><br><span class="line"><span class="comment">//		struct v2f&#123;</span></span><br><span class="line"><span class="comment">//			float4 position : SV_POSITION;</span></span><br><span class="line"><span class="comment">//			float2 uv : TEXCOORD0;</span></span><br><span class="line"><span class="comment">//		&#125;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//顶点着色器函数，主要执行坐标的空间变换</span></span><br><span class="line"><span class="comment">//		v2f vert(appdata v)&#123;</span></span><br><span class="line"><span class="comment">//			v2f o;</span></span><br><span class="line"><span class="comment">//			//将模型各顶点坐标，转换到裁剪空间</span></span><br><span class="line"><span class="comment">//			o.position = UnityObjectToClipPos(v.vertex);</span></span><br><span class="line"><span class="comment">//			//基于图片的缩放偏移参数，对UV进行变换</span></span><br><span class="line"><span class="comment">//			o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span></span><br><span class="line"><span class="comment">//			return o;</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//片段作色器，主要是计算像素点的颜色</span></span><br><span class="line"><span class="comment">//		fixed4 frag(v2f i) : SV_TARGET&#123;</span></span><br><span class="line"><span class="comment">//			//基于UV坐标，进行纹理采样</span></span><br><span class="line"><span class="comment">//			fixed4 col = tex2D(_MainTex, i.uv);</span></span><br><span class="line"><span class="comment">//			//将纹理颜色和材质颜色相乘</span></span><br><span class="line"><span class="comment">//			col *= _Color;</span></span><br><span class="line"><span class="comment">//			//返回最终的像素点颜色</span></span><br><span class="line"><span class="comment">//			return col;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	Fallback <span class="string">&quot;VertexLit&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>希望你能喜欢这个教程哦！如果你想支持我，可以关注我的<a target="_blank" rel="noopener" href="https://twitter.com/totallyRonja">推特</a>,或者通过<a target="_blank" rel="noopener" href="https://ko-fi.com/ronjatutorials">ko-fi</a>、或<a target="_blank" rel="noopener" href="https://www.patreon.com/RonjaTutorials">patreon</a>给两小钱。总之，各位大爷，走过路过不要错过，有钱的捧个钱场，没钱的捧个人场:-)!!!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/06/21/Compute_Shader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/06/21/Compute_Shader/" class="post-title-link" itemprop="url">Compute Shader</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-21 15:01:00" itemprop="dateCreated datePublished" datetime="2021-06-21T15:01:00+08:00">2021-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/Shader/" itemprop="url" rel="index"><span itemprop="name">Shader</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文：<br><a target="_blank" rel="noopener" href="https://www.ronja-tutorials.com/post/050-compute-shader/">Compute Shader</a></p>
<p>至此，我们已经学会了如何使用固定管线来渲染纹理，但是目前的显卡能做的远远不止这些。除了使用固定管线，我们还可以使用compute shader来实现。</p>
<p>你可能会问，为什么要用compute shader，目前的cpu其实已经很强大了，即便遇到大量的处理数据，我们也可以使用多线程来处理。是的，对于一些非图形任务，我们并不需要使用GPU。如果强行使用GPU来处理，很可能会产生各种未知错误，另外也无法使用常用的异常分析手段。优化就更麻烦了，因为需要考虑CPU与GPU之间的数据传输，而GPU并行处理也和CPU编程思路不一样。作为初学者，我们是否需要使用compute shader，首先要明白为什么要用compute shader，使用后是否能够达到比现有方法更好的效果。</p>
<p>如果你觉得你需要使用compute shader，那么继续读下去。在Unity中，你可以使用<code>SystemInfo.supportsComputeShaders</code>方法来查看你的GPU是否支持compute shader。<br><img src="https://www.ronja-tutorials.com/assets/images/posts/050/result.gif"></p>
<h2 id="Basic-Compute-Shader"><a href="#Basic-Compute-Shader" class="headerlink" title="Basic Compute Shader"></a>Basic Compute Shader</h2><p>我们可以通过选中<code>Create&gt;Shader&gt;Compute Shader</code>来创建compute shader。默认创建的compute shader执行向图片中写入数据的操作。但是在本节，我将演示一个更简单的例子——写入一组坐标。</p>
<p>在compute shader中，我们可以向<code>RWStructuredBuffer</code>中写入一组数据，而<code>StructuredBuffer</code>是只读数据。在它们后面补充数据单元类型，类型包括<code>vector</code>或者<code>struct</code>。在本节中，我们使用<code>float3</code>。</p>
<p>我们把用于计算的方法块叫做<code>kernel</code>。我们必须在方法块前面添加<code>numthreads</code>标志符，同时方法块有一个输入参数，因为方法块是针对每一个元素进行并行计算的，所以需要一个索引值来表明当前方法块所对应的元素。在这里，我们定义x轴64线程，y、z轴都是1线程。只要支持compute shader的显卡，基本可以处理这种线程设置。因为整个线程设置是一维的，所以我们处理的数据也是一维的，而在并行处理中，我们只需要考虑单个元素的处理过程。因为我们的线程设置是基于三个维度，所以我们输入参数也是三个维度，参数中的值对应相应维度的线程。因为我们这里的数据都集中在x轴上，所以我们的参数也只需要考虑x轴的索引。和普通的Shader一样，我们需要为输入参数添加标志符，方便程序识别参数的语意，这里我们参数的标志符是<code>SV_DispatchThreadID</code>。</p>
<p>为了区分compute shader中的普通方法块和核方法块，我们需要使用<code>pragma</code>标识符，语法为<code>#pragma kernel &lt;functionname&gt;</code>。当然，在一个compute shader中可以拥有多个核函数。例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定一个核函数，我们可以拥有多个核函数</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> kernel Spheres</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">RWStructuredBuffer&lt;float3&gt; Result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[numthreads(<span class="number">64</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Spheres</span><span class="params">(uint3 id : SV_DispatchThreadID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// compute shader 代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，让我们输出坐标<code>(id, 0, 0)</code>到<code>Result</code>中：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[numthreads(<span class="number">64</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Spheres</span><span class="params">(uint3 id : SV_DispathcThreadID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Result[id.x] = float3(id.x, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Executing-Compute-Shaders"><a href="#Executing-Compute-Shaders" class="headerlink" title="Executing Compute Shaders"></a>Executing Compute Shaders</h2><p>和普通的Shader不同的是，compute shader并不是通过材质绑定的方式来执行，而是通过<code>C#</code>脚本来实现调用。</p>
<p>我们可以创建一个GameObject，并且在它上面创建一个<code>C#</code>脚本，在脚本上创建一个<code>ComputeShader</code>变量来引用前面创建的compute shader。同时我们创建一个整形变量，用来存储核函数的签名，这个签名是核函数在GPU中的索引ID。首先在<code>Start</code>函数中我们调用<code>FindKernel(&lt;kernelname&gt;)</code>来获取核函数的签名。在得到核函数签名后，我们可以使用该签名来获取该核函数的线程设置，也就是在compute shader中的<code>[numthreads(64, 1, 1)]</code>。我们只提取x轴的线程数，其他两个维度可以用<code>_</code>来表示忽略。</p>
<p>另外，我们在<code>C#</code>脚本中创建一个长度变量，用来指定compute shader中buffer的长度。知道buffer的长度，以及buffer中存储的数据类型<code>float3</code>，我们可以向GPU申请一块存储空间——<code>ComputeBuffer</code>。这个空间将会用来存储计算结果，也就是compute shader中的<code>Result</code>。创建<code>ComputeBuffer</code>需要两个参数，第一参数是元素的个数，第二个参数是元素的大小。我们的元素是<code>float3</code>，也就是大小为3个<code>float</code>。另外，我们需要在CPU中申请一块和<code>ComputeBuffer</code>同样大小的数组空间，以便于将计算后的结果转移到CPU，方便后续计算使用。在计算结束后，我们可以通过<code>ComputeBuffer.Dispose</code>方法来释放GPU申请的缓存空间。</p>
<p>当一切设置好后，我们可以在<code>Update</code>中使用compute shader。首先，我们需要将我们在GPU创建的<code>ComputeBuffer</code>和compute shader中的buffer相关联。在调用compute shader之前，我们还需要计算整个核函数需要执行多少遍，这个叫做线程组。因为核函数单次批处理的数量有限，所以需要分为多组，分批次处理。例如这里我们单次x轴处理量为64，而总的需要处理的数量为buffer长度，那么线程组的个数为后者处以前者。然后通过<code>dispatch</code>方法来启用核函数，最终计算结果通过<code>GetData</code>函数传回到CPU中。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicComputeSpheres</span> :</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> SphereAmount = <span class="number">17</span>;</span><br><span class="line">    <span class="keyword">public</span> ComputeShader Shader;</span><br><span class="line"></span><br><span class="line">    ComputeBuffer resultBuffer;</span><br><span class="line">    <span class="keyword">int</span> kernel;</span><br><span class="line">    uint threadGroupSize;</span><br><span class="line">    Vector3[] output;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取核函数签名</span></span><br><span class="line">        kernel = Shader.FindKernel(<span class="string">&quot;Spheres&quot;</span>);</span><br><span class="line">		<span class="comment">// 获取核函数线程设置</span></span><br><span class="line">        Shader.GetKernelThreadGroupSizes(kernel, out threadGroupSize, out _, out _);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//buffer on the gpu in the ram</span></span><br><span class="line">        resultBuffer = <span class="keyword">new</span> ComputeBuffer(SphereAmount, <span class="keyword">sizeof</span>(<span class="keyword">float</span>) * <span class="number">3</span>);</span><br><span class="line">        output = <span class="keyword">new</span> Vector3[SphereAmount];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">		<span class="comment">//绑定数据</span></span><br><span class="line">        Shader.SetBuffer(kernel, <span class="string">&quot;Result&quot;</span>, resultBuffer);</span><br><span class="line">        <span class="keyword">int</span> threadGroups = (<span class="keyword">int</span>) ((SphereAmount + (threadGroupSize - <span class="number">1</span>)) / threadGroupSize);</span><br><span class="line">        Shader.Dispatch(kernel, threadGroups, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        resultBuffer.GetData(output);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDestroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        resultBuffer.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们有了计算结果，但是并不能直观的去观察这些结果。有很多种方法可以直接在GPU中处理并显示这些结果，但是这并不是本文的重点。所以我选择使用生成一系列模型空间分布，来展示最终生成的结果。<br>在<code>Update</code>中直接将计算的坐标赋值给游戏物体空间坐标。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in start method</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//spheres we use for visualisation</span></span><br><span class="line">instances = <span class="keyword">new</span> Transform[SphereAmount];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SphereAmount; i++)</span><br><span class="line">&#123;</span><br><span class="line">    instances[i] = Instantiate(Prefab, transform).transform;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//in update method</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; instances.Length; i++)</span><br><span class="line">    instances[i].localPosition = output[i];</span><br></pre></td></tr></table></figure>
<p><img src="https://www.ronja-tutorials.com/assets/images/posts/050/Row.png"></p>
<h2 id="A-tiny-bit-more-complex-Compute-Shader"><a href="#A-tiny-bit-more-complex-Compute-Shader" class="headerlink" title="A tiny bit more complex Compute Shader"></a>A tiny bit more complex Compute Shader</h2><p>为了达到一个更好的视觉效果，请继续阅读，别担心这里涉及到的也只是基本的hlsl语法。</p>
<p>在compute shader中我加入了<a target="_blank" rel="noopener" href="https://www.ronja-tutorials.com/post/024-white-noise/">randomness</a>教程中关于噪声的函数，同时加入时间变量。在核函数中，我基于输入参数来构造一个长度为[0.1-1]的随机向量。然后采用叉乘的方法计算出与这些随机向量垂直的向量。然后使用时间变量的平方，加上一个比较大的奇数，得到一个关于时间的<code>sin</code>值和<code>cos</code>，最后将这两个值和两个随机向量相乘，并求和。在这个基础上乘以20，使得记过看起来更明显。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Each #kernel tells which function to compile; you can have many kernels</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> kernel Spheres</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Random.cginc&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//variables</span></span><br><span class="line">RWStructuredBuffer&lt;float3&gt; Result;</span><br><span class="line">uniform <span class="keyword">float</span> Time;</span><br><span class="line"></span><br><span class="line">[numthreads(<span class="number">64</span>,<span class="number">1</span>,<span class="number">1</span>)]</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Spheres</span> <span class="params">(uint3 id : SV_DispatchThreadID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//generate 2 orthogonal vectors</span></span><br><span class="line">    float3 baseDir = normalize(rand1dTo3d(id.x) - <span class="number">0.5</span>) * (rand1dTo1d(id.x)*<span class="number">0.9</span>+<span class="number">0.1</span>);</span><br><span class="line">    float3 orthogonal = normalize(cross(baseDir, rand1dTo3d(id.x + <span class="number">7.1393</span>) - <span class="number">0.5</span>)) * (rand1dTo1d(id.x+<span class="number">3.7443</span>)*<span class="number">0.9</span>+<span class="number">0.1</span>);</span><br><span class="line">    <span class="comment">//scale the time and give it a random offset</span></span><br><span class="line">    <span class="keyword">float</span> scaledTime = Time * <span class="number">2</span> + rand1dTo1d(id.x) * <span class="number">712.131234</span>;</span><br><span class="line">    <span class="comment">//calculate a vector based on vectors</span></span><br><span class="line">    float3 dir = baseDir * <span class="built_in">sin</span>(scaledTime) + orthogonal * <span class="built_in">cos</span>(scaledTime);</span><br><span class="line">    Result[id.x] = dir * <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，我们很需要在<code>C#</code>脚本中向compute shader中传入时间变量。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shader.SetFloat(<span class="string">&quot;Time&quot;</span>, Time.time);</span><br></pre></td></tr></table></figure>

<p>然后使用自发光材质，以及泛光后处理技术，最后呈现出下面绚烂的效果。<br><img src="https://www.ronja-tutorials.com/assets/images/posts/050/result.gif"></p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a target="_blank" rel="noopener" href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/050_Compute_Shader/BasicCompute.compute">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/050_Compute_Shader/BasicCompute.compute</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Each #kernel tells which function to compile; you can have many kernels</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> kernel Spheres</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Random.cginc&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//variables</span></span><br><span class="line">RWStructuredBuffer&lt;float3&gt; Result;</span><br><span class="line">uniform <span class="keyword">float</span> Time;</span><br><span class="line"></span><br><span class="line">[numthreads(<span class="number">64</span>,<span class="number">1</span>,<span class="number">1</span>)]</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Spheres</span> <span class="params">(uint3 id : SV_DispatchThreadID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//generate 2 orthogonal vectors</span></span><br><span class="line">    float3 baseDir = normalize(rand1dTo3d(id.x) - <span class="number">0.5</span>) * (rand1dTo1d(id.x)*<span class="number">0.9</span>+<span class="number">0.1</span>);</span><br><span class="line">    float3 orthogonal = normalize(cross(baseDir, rand1dTo3d(id.x + <span class="number">7.1393</span>) - <span class="number">0.5</span>)) * (rand1dTo1d(id.x+<span class="number">3.7443</span>)*<span class="number">0.9</span>+<span class="number">0.1</span>);</span><br><span class="line">    <span class="comment">//scale the time and give it a random offset</span></span><br><span class="line">    <span class="keyword">float</span> scaledTime = Time * <span class="number">2</span> + rand1dTo1d(id.x) * <span class="number">712.131234</span>;</span><br><span class="line">    <span class="comment">//calculate a vector based on vectors</span></span><br><span class="line">    float3 dir = baseDir * <span class="built_in">sin</span>(scaledTime) + orthogonal * <span class="built_in">cos</span>(scaledTime);</span><br><span class="line">    Result[id.x] = dir * <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/050_Compute_Shader/BasicComputeSpheres.cs">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/050_Compute_Shader/BasicComputeSpheres.cs</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicComputeSpheres</span> :</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> SphereAmount = <span class="number">17</span>;</span><br><span class="line">    <span class="keyword">public</span> ComputeShader Shader;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject Prefab;</span><br><span class="line"></span><br><span class="line">    ComputeBuffer resultBuffer;</span><br><span class="line">    <span class="keyword">int</span> kernel;</span><br><span class="line">    uint threadGroupSize;</span><br><span class="line">    Vector3[] output;</span><br><span class="line"></span><br><span class="line">    Transform[] instances;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//program we&#x27;re executing</span></span><br><span class="line">        kernel = Shader.FindKernel(<span class="string">&quot;Spheres&quot;</span>);</span><br><span class="line">        Shader.GetKernelThreadGroupSizes(kernel, out threadGroupSize, out _, out _);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//buffer on the gpu in the ram</span></span><br><span class="line">        resultBuffer = <span class="keyword">new</span> ComputeBuffer(SphereAmount, <span class="keyword">sizeof</span>(<span class="keyword">float</span>) * <span class="number">3</span>);</span><br><span class="line">        output = <span class="keyword">new</span> Vector3[SphereAmount];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//spheres we use for visualisation</span></span><br><span class="line">        instances = <span class="keyword">new</span> Transform[SphereAmount];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SphereAmount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            instances[i] = Instantiate(Prefab, transform).transform;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Shader.SetFloat(<span class="string">&quot;Time&quot;</span>, Time.time);</span><br><span class="line">        Shader.SetBuffer(kernel, <span class="string">&quot;Result&quot;</span>, resultBuffer);</span><br><span class="line">        <span class="keyword">int</span> threadGroups = (<span class="keyword">int</span>) ((SphereAmount + (threadGroupSize - <span class="number">1</span>)) / threadGroupSize);</span><br><span class="line">        Shader.Dispatch(kernel, threadGroups, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        resultBuffer.GetData(output);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; instances.Length; i++)</span><br><span class="line">            instances[i].localPosition = output[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDestroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        resultBuffer.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>希望你能喜欢这个教程 :-)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/05/27/WebReference/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/05/27/WebReference/" class="post-title-link" itemprop="url">Web Reference</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-27 17:01:34" itemprop="dateCreated datePublished" datetime="2021-05-27T17:01:34+08:00">2021-05-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Geometry"><a href="#Geometry" class="headerlink" title="Geometry"></a>Geometry</h2><h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><p><a target="_blank" rel="noopener" href="http://www.songho.ca/opengl/gl_projectionmatrix.html">OpenGL Projection Matrix</a>:Opengl中的矩阵应用；<br><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21999356">欧拉公式 e^{i<em>k}=cos(k)+i</em>sin(k) 的来历是什么？</a>:欧拉公式;<br><a target="_blank" rel="noopener" href="https://www.shuxuele.com/algebra/systems-linear-equations-matrices.html">线性方程组矩阵解法</a>:线性方程组矩阵解法;<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/leonardohaig/article/details/110881364">判断线段是否相交并求交点</a>:判断线段是否相交并求交点;<br><a target="_blank" rel="noopener" href="https://fgiesen.wordpress.com/">The ryg blog</a><br><a target="_blank" rel="noopener" href="https://bit-hack.net/2014/03/30/circular-harmonics/">Circular Harmonics</a><br><a target="_blank" rel="noopener" href="https://cp-algorithms.com/index.html#geometry">Algorithms for Competitive Programming</a></p>
<h3 id="Noise"><a href="#Noise" class="headerlink" title="Noise"></a>Noise</h3><p><a target="_blank" rel="noopener" href="http://devmag.org.za/2009/05/03/poisson-disk-sampling/">Poisson Disk Sampling</a>:泊松采样；<br><a target="_blank" rel="noopener" href="https://iquilezles.org/www/articles/warp/warp.htm">Warping</a>:Warping, or dommain distortion is a very common technique in computer graphics for generating procedural textures and geometry;<br><a target="_blank" rel="noopener" href="https://www.redblobgames.com/articles/noise/2d/">2D noise</a>:These are some quick &amp; dirty experiments I did with 2D noise;<br><a target="_blank" rel="noopener" href="https://github.com/KdotJPG/OpenSimplex2">OpenSimplex 2</a>:Successors to OpenSimplex Noise, plus updated OpenSimplex;</p>
<h3 id="Polygon"><a href="#Polygon" class="headerlink" title="Polygon"></a>Polygon</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Even%E2%80%93odd_rule">Even–odd rule</a>:奇偶法判定点与多边形的关系；<br><a target="_blank" rel="noopener" href="https://sean.cm/a/polygon-clipping-pt1">Polygon Clipping (Part 1)</a>:多边形布尔运算；<br><a target="_blank" rel="noopener" href="https://sean.cm/a/polygon-clipping-pt2">Polygon Clipping (Part 2)</a>:多边形布尔运算；<br><a target="_blank" rel="noopener" href="https://barendgehrels.blogspot.com/2010/12/intersections-1.html">Barend’s Blog</a>:多边形布尔运算；<br><a target="_blank" rel="noopener" href="https://cs.stackexchange.com/questions/99927/concave-polygon-intersection-algorithm">Concave Polygon Intersection - Algorithm</a>:多边形布尔运算；<br><a target="_blank" rel="noopener" href="https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html">PNPOLY - Point Inclusion in Polygon Test W. Randolph Franklin (WRF)</a>:…;</p>
<h3 id="Mesh"><a href="#Mesh" class="headerlink" title="Mesh"></a>Mesh</h3><p><a target="_blank" rel="noopener" href="https://0fps.net/2012/06/30/meshing-in-a-minecraft-game/">Meshing in a Minecraft Game</a>:网格合并贪心算法；<br><a target="_blank" rel="noopener" href="http://experilous.com/1/blog/post/procedural-planet-generation">planet generator</a>:行星网格；<br><a target="_blank" rel="noopener" href="http://eveliosdev.blogspot.com/2016/06/plate-tectonics.html">Evelios Development</a>:地图网格生成；<br><a target="_blank" rel="noopener" href="https://heredragonsabound.blogspot.com/2019/02/perlin-noise-procedural-content.html">Exploring procedural generation and display of fantasy maps</a>:地图生成；<br><a target="_blank" rel="noopener" href="https://squeakyspacebar.github.io/2017/07/12/Procedural-Map-Generation-With-Voronoi-Diagrams.html">Procedural Terrain Generation With Voronoi Diagrams</a>:地图生成；<br><a target="_blank" rel="noopener" href="https://github.com/squeakyspacebar/novatellus">a map generator based on Voronoi diagrams</a>:地图生成；<br><a target="_blank" rel="noopener" href="https://github.com/averrin/mapgen-viewer">Map generator based on Voronoi Diagram and Perlin noise</a>:地图生成；<br><a target="_blank" rel="noopener" href="https://github.com/Zalgo2462/VoronoiLib">VoronoiLib</a>:C# implementation of Fortune’s Algorithm;<br><a target="_blank" rel="noopener" href="https://leatherbee.org/index.php/2018/10/06/terrain-generation-3-voronoi-diagrams/">Terrain Generation 3: Voronoi Diagrams</a>:generating a small number of large Voronoi cells as tectonic plates;<br><a target="_blank" rel="noopener" href="https://github.com/michaellasky/ManyLandsGenerator">ManyLandsGenerator</a>:The Random Island Generator being developed for use in The Rogue Sea;<br><a target="_blank" rel="noopener" href="https://github.com/jceipek/Unity-delaunay">Unity-delaunay</a>:Port of as3delaunay to C# for Unity;<br><a target="_blank" rel="noopener" href="https://github.com/KHN190/miniHexMap">miniHexMap</a>:Create, edit, generate hex mesh in Unity Editor mode;<br><a target="_blank" rel="noopener" href="https://mapbox.github.io/delaunator/">Delaunator guide</a>:a fast library for Delaunay triangulation;<br><a target="_blank" rel="noopener" href="https://github.com/squeakyspacebar/csDelaunay">#csDelaunay</a>:This is a refactoring of PouletFrit’s C# port of as3delaunay;<br><a target="_blank" rel="noopener" href="https://github.com/PouletFrit/csDelaunay">csDelaunay</a>:This is a port and interpretation of actionscript library as3delaunay;<br><a target="_blank" rel="noopener" href="https://github.com/tyoden/VoronoiUnityDOTS">VoronoiUnityDOTS</a>:Fortune’s Voronoi diagram for Unity DOTS (Job System, Burst Compiler) - WIP;<br><a target="_blank" rel="noopener" href="https://github.com/LanLou123/Webgl-Erosion">Terrain erosion sandbox in WebGl</a>:Erosion simulation in Web Browser;</p>
<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p><a target="_blank" rel="noopener" href="https://arongranberg.com/astar/">A* Pathfinding Project</a><br><a target="_blank" rel="noopener" href="http://www.critterai.org/projects/nmgen_study/">Study: Navigation Mesh Generation</a><br><a target="_blank" rel="noopener" href="https://github.com/Seed-XL/Study-Navigation-Mesh-Generation">Study-Navigation-Mesh-Generation</a><br><a target="_blank" rel="noopener" href="https://github.com/Hifumi123/NavMesh">NavMesh</a><br><a target="_blank" rel="noopener" href="https://github.com/BIG-b8/navMesh">navMesh</a><br><a target="_blank" rel="noopener" href="https://github.com/phillip-ables/unity-nav-mesh">unity-nav-mesh</a><br><a target="_blank" rel="noopener" href="https://github.com/kimsama/Unity-NavMeshAgent-SelfDriving">Unity-NavMeshAgent-SelfDriving</a><br><a target="_blank" rel="noopener" href="https://github.com/Reddeyfish/NavMeshWith2D">NavMeshWith2D</a><br><a target="_blank" rel="noopener" href="https://github.com/Haxixi/NavMeshComponents">Components for Runtime NavMesh Building</a><br><a target="_blank" rel="noopener" href="https://github.com/pikol93/NavigationMesh">NavigationMesh</a><br><a target="_blank" rel="noopener" href="https://digestingduck.blogspot.com/search?q=Navigation+">Digesting Duck</a><br><a target="_blank" rel="noopener" href="https://github.com/recastnavigation/recastnavigation">recastnavigation</a><br><a target="_blank" rel="noopener" href="https://github.com/OlegDzhuraev/NavMeshAvoidance">Nav Mesh Avoidance</a><br><a target="_blank" rel="noopener" href="https://github.com/jadvrodrigues/CustomNavMesh">Custom Nav Mesh</a><br><a target="_blank" rel="noopener" href="https://fribbels.github.io/shortestpath/writeup.html">Euclidean Shortest Paths</a>:避障寻路；<br><a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~16311/current/schedule/ppp/Lec12-MotionPlanning4.pdf">Motion Planning, Part IV Graph Search Part II</a>:路径规划；<br><a target="_blank" rel="noopener" href="https://aaai.org/ocs/index.php/AIIDE/AIIDE10/paper/view/2139/2547">A Comparison of High-Level Approaches for Speeding Up Pathfinding</a>:寻路优化；<br><a target="_blank" rel="noopener" href="http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=5E67F3A553B41B61F9F0FCA0DDF17128?doi=10.1.1.138.7223&rep=rep1&type=pdf">TRANSIT: Ultrafast Shortest-Path Queries with Linear-Time Preprocessing</a>:寻路；<br><a target="_blank" rel="noopener" href="https://www.aaai.org/ocs/index.php/AIIDE/AIIDE12/paper/view/5459/5688">TRANSIT Routing on Video Game Maps</a>:寻路；<br><a target="_blank" rel="noopener" href="https://harablog.wordpress.com/2009/02/05/hierarchical-clearance-based-pathfinding/">Shortest Path</a>:寻路；<br><a target="_blank" rel="noopener" href="https://harablog.files.wordpress.com/2009/01/haa.pdf">Hierarchical Path Planning for Multi-Size Agents in Heterogeneous Environments</a>:寻路；<br><a target="_blank" rel="noopener" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.14.6477&rep=rep1&type=pdf">Fully Dynamic Constrained Delaunay Triangulations</a>:寻路；<br><a target="_blank" rel="noopener" href="http://algo2.iti.kit.edu/schultes/hwy/schultes_diss.pdf">Route Planning in Road Networks</a>:路网寻路方案；<br><a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2004/07/tr-2004-24.pdf">Computing the Sortest Path: A* Search Meets Graph Theory</a>:A<em>寻路；<br><a target="_blank" rel="noopener" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.42.1704&rep=rep1&type=pdf">Hierarchical A*: Searching Abstraction Hierarchies Efficiently</a>:A</em>寻路算法优化；<br><a target="_blank" rel="noopener" href="https://www.redblobgames.com/pathfinding/a-star/introduction.html">Introduction to the A* Algorithm</a>:Introduction to the A* Algorithm;<br><a target="_blank" rel="noopener" href="http://blog.runevision.com/2016/03/note-on-creating-natural-paths-in.html">Creating natural paths on terrains using pathfinding</a>:道路自动生成；<br><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/dijkstras-shortest-path-algorithm-greedy-algo-7/">Dijkstra’s shortest path algorithm | Greedy Algo-7</a><br><a target="_blank" rel="noopener" href="https://www.freecodecamp.org/news/dijkstras-shortest-path-algorithm-visual-introduction/">Dijkstra’s Shortest Path Algorithm - A Detailed and Visual Introduction</a></p>
<h3 id="Graphs"><a href="#Graphs" class="headerlink" title="Graphs"></a>Graphs</h3><p><a target="_blank" rel="noopener" href="http://www.science.smith.edu/~istreinu/Teaching/Courses/274/Spring98/Projects/Philip/fp/algVisibility.htm">Algorithm for Computing Visibility Graphs</a>:基于障碍物构造图；<br><a target="_blank" rel="noopener" href="http://www.cs.kent.edu/~dragan/ST-Spring2016/visibility%20graphs.pdf">Visibility graphs</a>:视线图;<br><a target="_blank" rel="noopener" href="https://github.com/xw0/spherical_voronoi_core">spherical_voronoi_core</a>:Voronoi Tessellation of the Sphere;</p>
<h2 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h2><p><a target="_blank" rel="noopener" href="https://github.com/UnityTechnologies/open-project-1">Unity Open Project</a><br><a target="_blank" rel="noopener" href="https://open.codecks.io/unity-open-project-1/decks/15-code/card/19j-combat-system">Unity Open Projects</a><br><a target="_blank" rel="noopener" href="https://gamedevacademy.org/category/tutorials/unity-tutorials/unity-3d-tutorials/page/2/">GameDev Academy</a><br><a target="_blank" rel="noopener" href="https://unitylist.com/p/1291/Game-Dev">Game Dev</a><br><a target="_blank" rel="noopener" href="https://unitylist.com/p/13vf/Fighting-Game-3d-Multiplayer-Unity3D">Fighting Game 3d Multiplayer Unity3D</a><br><a target="_blank" rel="noopener" href="https://github.com/AnshuNair/SimpleMultiplayerProject">SimpleMultiplayerProject</a><br><a target="_blank" rel="noopener" href="https://github.com/Aleqsd/Heroes-of-the-Skills">Heroes of the Skills</a><br><a target="_blank" rel="noopener" href="https://github.com/Kisamegr/NeuroThingy">Neuroevolution of 2-legged creatures learning to walk further-faster</a></p>
<h3 id="SLG"><a href="#SLG" class="headerlink" title="SLG"></a>SLG</h3><p><a target="_blank" rel="noopener" href="https://pvigier.github.io/2020/02/09/vagabond-building-generation.html">pvigier’s blog</a>:地图自动生成、寻路等一套完整的解决方案；<br><a target="_blank" rel="noopener" href="http://www-cs-students.stanford.edu/~amitp/games.html">The SimBlob Project</a>:地图自动生成、寻路等一套完整的解决方案；<br><a target="_blank" rel="noopener" href="https://thecolonistsgame.com/">The Colonists</a>:游戏；<br><a target="_blank" rel="noopener" href="http://www.82apps.com/factorytown/">Factory Town</a>:游戏；<br><a target="_blank" rel="noopener" href="https://store.steampowered.com/app/874390/The_Battle_of_Polytopia/">The Battle of Polytopia</a>:游戏；<br><a target="_blank" rel="noopener" href="https://civilization.com/zh-CN/new-frontier-pass/civilization-vi-vietnam-kublai-khan-pack/">文明VI: 新纪元季票</a>:游戏；<br><a target="_blank" rel="noopener" href="http://www.shiningrocksoftware.com/2011-05-16-the-doors-are-open/">Banished</a>:一些设计实现思路；<br><a target="_blank" rel="noopener" href="https://github.com/Wargus/stratagus">stratagus</a>:The Stratagus strategy game engine;<br><a target="_blank" rel="noopener" href="https://sourceforge.net/directory/?q=turn%20based%20military%20strategy%20games">turn based military strategy games</a>:搜索游戏；<br><a target="_blank" rel="noopener" href="http://assetstore.unitylover.com/unity_asset/turn-based-toolkit-tbtk/">Turn-Based ToolKit (TBTK)</a>:子走棋；<br><a target="_blank" rel="noopener" href="https://unity.com/how-to/advanced/optimize-lighting-mobile-games?_ga=2.238992768.1610235152.1617097265-1411223696.1612421527">Light baked Prefabs &amp; other tips to get 60 fps on low-end phones</a>:tips from Michelle Martin, software engineer at MetalPop Games, on how to optimize games for a range of mobile devices, so you can reach as many potential players as possible;<br><a target="_blank" rel="noopener" href="https://tuanisapps.itch.io/extinction-eclipse">Extinction Eclipse</a><br><a target="_blank" rel="noopener" href="https://manlaig.github.io/projects">Michael Ganzorig</a></p>
<h2 id="Render"><a href="#Render" class="headerlink" title="Render"></a>Render</h2><h3 id="Color"><a href="#Color" class="headerlink" title="Color"></a>Color</h3><p><a target="_blank" rel="noopener" href="https://simonstechblog.blogspot.com/">Studying Gamut Clipping</a>:色域裁剪研究，用于将颜色限定在有效范围内；<br><a target="_blank" rel="noopener" href="https://blog.frame.io/2019/08/12/luts-101/">LUTs</a></p>
<h3 id="Lighting"><a href="#Lighting" class="headerlink" title="Lighting"></a>Lighting</h3><p><a target="_blank" rel="noopener" href="https://theory.cpe.ku.ac.th/~pramook/files/prosem_paper.pdf">Spherical Harmonics</a>:球谐函数原理；<br><a target="_blank" rel="noopener" href="http://www.ppsloan.org/publications/StupidSH36.pdf">Stupid Spherical Harmonics (SH) Tricks</a>:球谐函数原理；<br><a target="_blank" rel="noopener" href="https://www.cs.cornell.edu/courses/cs5625/2016sp/slides/14sh-lighting.pdf">Spherical Harmonic Lighting</a>:球谐函数在光照中的应用；<br><a target="_blank" rel="noopener" href="https://lianera.github.io/post/2016/sh-lighting-exp/">Spherical Harmonics Lighting</a>:球谐函数光照应用；<br><a target="_blank" rel="noopener" href="https://zvxryb.github.io/blog/2015/08/20/sh-lighting-part1/">Spherical Harmonics Lighting: Part I</a>:球谐函数光照应用；<br><a target="_blank" rel="noopener" href="http://www.cse.chalmers.se/~uffe/xjobb/Readings/GlobalIllumination/Spherical%20Harmonic%20Lighting%20-%20the%20gritty%20details.pdf">Spherical Harmonic Lighting: The Gritty Details</a>:球谐函数光照应用；<br><a target="_blank" rel="noopener" href="https://www.gamasutra.com/view/news/128550/InDepth_Spherical_Harmonic_Lighting.php">In-Depth: Spherical Harmonic Lighting</a>:球鞋函数；<br><a target="_blank" rel="noopener" href="https://mynameismjp.wordpress.com/2016/10/09/sg-series-part-1-a-brief-and-incomplete-history-of-baked-lighting-representations/">SG SERIES PART 1: A BRIEF (AND INCOMPLETE) HISTORY OF BAKED LIGHTING REPRESENTATIONS</a>:烘焙光照介绍；<br><a target="_blank" rel="noopener" href="http://www.ppsloan.org/publications/">ppsloan</a>:一系列光照相关资料；<br><a target="_blank" rel="noopener" href="https://www.pbr-book.org/">Physically Based Rendering:From Theory To Implementation</a>:物理光照；<br><a target="_blank" rel="noopener" href="https://www.jordanstevenstechart.com/physically-based-rendering">Physically Based Rendering Algorithms: A Comprehensive Study In Unity3D</a>:物理光照详解；<br><a target="_blank" rel="noopener" href="https://www.codinblack.com/graphics-rendering-pipeline/">Graphics Rendering Pipeline</a>:渲染管线；<br><a target="_blank" rel="noopener" href="https://gameinstitute.qq.com/community/detail/115786">HLSL固有函数 【Intrinsic Functions (DirectX HLSL)】</a>:HLSL固有函数；<br><a target="_blank" rel="noopener" href="http://www.thetenthplanet.de/archives/255">The Blinn-Phong Normalization Zoo</a>:The Blinn-Phong Normalization Zoo;</p>
<h3 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h3><p><a target="_blank" rel="noopener" href="https://blog.unity.com/technology/custom-lighting-in-shader-graph-expanding-your-graphs-in-2019">Custom Lighting in Shader Graph: Expanding your graphs in 2019</a><br><a target="_blank" rel="noopener" href="https://danielilett.com/2021-05-20-every-shader-graph-node/">How To Use Every Node in Unity Shader Graph</a><br><a target="_blank" rel="noopener" href="https://github.com/UnityTechnologies/Test_ShaderGraphBlog">Test_ShaderGraphBlog</a><br><a target="_blank" rel="noopener" href="https://www.red-gate.com/simple-talk/development/dotnet-development/post-processing-effects-unity/">Using post-processing effects in Unity</a><br><a target="_blank" rel="noopener" href="https://forum.unity.com/threads/interior-mapping.424676/#post-2751518">Interior Mapping</a><br><a target="_blank" rel="noopener" href="http://www.humus.name/index.php?page=3D&ID=80">Interior Mapping</a><br><a target="_blank" rel="noopener" href="https://github.com/keijiro/DepthInverseProjection">DepthInverseProjection</a>:深度重构<br><a target="_blank" rel="noopener" href="https://thebookofshaders.com/">The Book of Shaders</a><br><a target="_blank" rel="noopener" href="https://halisavakis.com/category/blog-posts/my-take-on-shaders/page/5/">Harry Alisavakis的博客</a>:一些着色器学习例子<br><a target="_blank" rel="noopener" href="https://origin.80.lv/articles/creating-a-stylized-waterfall-in-unity-part-1/">Creating A Stylized Waterfall in Unity: Part 1</a>:Math Roodhuizen allowed us to repost his guide to creating a RiME-style waterfall in Unity, Amplify Shader Editor, and Maya;<br><a target="_blank" rel="noopener" href="https://bronsonzgeb.com/index.php/2021/02/27/particle-metaballs-in-unity-using-urp-and-shader-graph-part-1/">Particle Metaballs in Unity using URP and Shader Graph Part 1</a>:This series will explain how to draw Metaballs in Unity using the Universal Render Pipeline (URP) and Shader Graph;<br><a target="_blank" rel="noopener" href="https://www.scratchapixel.com/lessons/advanced-rendering/rendering-distance-fields/introduction">Rendering Implicit Surfaces and Distance Fields: Sphere Tracing</a>:Rendering Implicit Surfaces and Distance Fields: Sphere Tracing;<br><a target="_blank" rel="noopener" href="https://www.ronja-tutorials.com/">Shader Tutorials by Ronja</a>:The focus of this tutorials is on unity shaders with hlsl;<br><a target="_blank" rel="noopener" href="https://www.cyanilux.com/tutorials/depth/">depth</a>:This post goes over everything about depth that I’ve come across (so you could say it’s an in-depth post about depth!), mainly focusing on Unity and the Universal RP (but also includes some High Definition RP stuff). Includes info for both Shader Graph and URP Shader Code (HLSL).<br><a target="_blank" rel="noopener" href="https://watersimulation.tumblr.com/">Water simulation</a></p>
<h2 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h2><p><a target="_blank" rel="noopener" href="https://github.com/stolk/GPGOAP">GPGOAP</a>:面向目标的行为规划；<br><a target="_blank" rel="noopener" href="http://alumni.media.mit.edu/~jorkin/goap.html">Goal-Oriented Action Planning (GOAP)</a><br><a target="_blank" rel="noopener" href="https://github.com/luxkun/ReGoap">ReGoap</a>:Generic C# GOAP (Goal Oriented Action Planning) library with Unity3d examples;<br><a target="_blank" rel="noopener" href="https://github.com/apoch/curvature">Curvature</a><br><a target="_blank" rel="noopener" href="https://github.com/FBast/ReflexityAI">ReflexityAI</a><br><a target="_blank" rel="noopener" href="https://github.com/Jay2645/UnrealUtilityAI">UnrealUtilityAI</a><br><a target="_blank" rel="noopener" href="https://gamedevelopment.tutsplus.com/tutorials/goal-oriented-action-planning-for-a-smarter-ai--cms-20793">Goal Oriented Action Planning for a Smarter AI</a><br><a target="_blank" rel="noopener" href="https://cryscan.github.io/project-chen/update/2021/02/17/goal-oriented-action-planning.html">Goal Oriented Action Planning Instructions</a></p>
<h2 id="Data-Struct"><a href="#Data-Struct" class="headerlink" title="Data Struct"></a>Data Struct</h2><h3 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h3><p><a target="_blank" rel="noopener" href="http://www.mikechambers.com/blog/2011/03/21/javascript-quadtree-implementation/">JavaScript QuadTree Implementation</a>:四叉树；<br><a target="_blank" rel="noopener" href="https://fribbels.github.io/vptree/writeup">VP Tree</a></p>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p><a target="_blank" rel="noopener" href="https://github.com/BlueRaja/High-Speed-Priority-Queue-for-C-Sharp">High-Speed-Priority-Queue-for-C-Sharp</a><br><a target="_blank" rel="noopener" href="https://www.dotnetlovers.com/article/231/priority-queue">Priority Queue</a><br><a target="_blank" rel="noopener" href="https://ericbackhage.net/c/how-to-design-a-priority-queue-in-c/">How to design a Priority Queue in C#</a><br><a target="_blank" rel="noopener" href="https://visualstudiomagazine.com/articles/2012/11/01/priority-queues-with-c.aspx">Priority Queues with C#</a></p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h3 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h3><p><a target="_blank" rel="noopener" href="https://www.log2base2.com/algorithms/sorting/quick-sort.html">Quick Sort</a><br><a target="_blank" rel="noopener" href="https://www.interviewbit.com/tutorial/quicksort-algorithm/">Quick Sort Algorithm</a><br><a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/data_structures_algorithms/quick_sort_algorithm.htm">Data Structure and Algorithms - Quick Sort</a></p>
<h3 id="AOI"><a href="#AOI" class="headerlink" title="AOI"></a>AOI</h3><p><a target="_blank" rel="noopener" href="http://docs2x.smartfoxserver.com/AdvancedTopics/advanced-mmo-api">Advanced uses of the MMORoom and MMO API</a><br><a target="_blank" rel="noopener" href="http://lecturer.ukdw.ac.id/~mahas/dossier/gameng_AIFG.pdf">ARTIFICIAL INTELLIGENCE FOR GAMES</a></p>
<h3 id="Fog"><a href="#Fog" class="headerlink" title="Fog"></a>Fog</h3><p><a target="_blank" rel="noopener" href="http://bobkoon.com/how-to-implement-a-fog-of-war-part-1-chunky/">How To: Implement a Fog of War – Part 1 – Chunky</a><br><a target="_blank" rel="noopener" href="https://bit-hack.net/2013/07/27/lode-storm-implementing-classic-fog-of-war/">Lode Storm – Implementing classic fog of war</a><br><a target="_blank" rel="noopener" href="https://github.com/topics/fog-of-war">fog-of-war</a><br><a target="_blank" rel="noopener" href="https://wiki.roll20.net/Advanced_Fog_of_War">Advanced Fog of War</a><br><a target="_blank" rel="noopener" href="http://phungdinhthang.com/2016/12/12/unreal-engine-4-fog-of-war-tutorial/?i=1">Unreal Engine 4 Fog Of War Tutorial – Ready To Use</a><br><a target="_blank" rel="noopener" href="https://github.com/manlaig/FogOfWar">Fog Of War in Unity</a></p>
<h2 id="Engine"><a href="#Engine" class="headerlink" title="Engine"></a>Engine</h2><h3 id="Unity"><a href="#Unity" class="headerlink" title="Unity"></a>Unity</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/final5788/article/details/100183528">Unity IL2CPP发布64位,以及代码裁剪Strip Engine Code</a>发布Unity项目时，需要注意代码裁剪的问题，Unity只能正确处理Apk包内的代码裁剪，像assetbundle资源上的代码就没办法正确裁剪，最终可能导致裁剪掉有用的代码而报错。<br><a target="_blank" rel="noopener" href="https://support.unity.com/hc/en-us/articles/210452343-How-to-stop-automatic-assembly-compilation-from-script">How to stop automatic assembly compilation from script</a><br><a target="_blank" rel="noopener" href="https://bitbucket.org/UnityUIExtensions/unity-ui-extensions/wiki/Controls/UIParticleSystem">UIParticleSystem</a><br><a target="_blank" rel="noopener" href="https://github.com/mob-sakai/ParticleEffectForUGUI">Particle Effect For UGUI</a><br><a target="_blank" rel="noopener" href="https://blog.unity.com/technology/automatic-setup-of-a-humanoid">Automatic Setup of a Humanoid</a><br><a target="_blank" rel="noopener" href="https://blog.unity.com/technology/mecanim-humanoids">Mecanim Humanoids</a><br><a target="_blank" rel="noopener" href="https://blog.unity.com/?p=82308">Unity Blogs</a><br><a target="_blank" rel="noopener" href="https://support.unity.com/hc/en-us/articles/115003118426-Running-multiple-instances-of-Unity-referencing-the-same-project">Running multiple instances of Unity referencing the same project</a><br><a target="_blank" rel="noopener" href="https://www.raywenderlich.com/16977649-pathfinding-with-navmesh-getting-started">Pathfinding in Games</a><br><a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/NavMeshComponents">NavMeshComponents</a><br><a target="_blank" rel="noopener" href="https://github.com/GOLDhjy/TreeViewExamples">TreeViewExamples</a><br><a target="_blank" rel="noopener" href="https://programmerall.com/search">unity editor</a><br><a target="_blank" rel="noopener" href="https://github.com/MattRix/UnityDecompiled">UnityDecompiled</a><br><a target="_blank" rel="noopener" href="https://github.com/CyberFoxHax/Unity3D_PreviewRenderUtility_Documentation/wiki/PreviewRenderUtility">PreviewRenderUtility</a><br><a target="_blank" rel="noopener" href="https://www.blog.radiator.debacle.us/2016/06/working-with-custom-objectpreviews-and.html">Working with custom ObjectPreviews and SkinnedMeshRenderers in Unity</a><br><a target="_blank" rel="noopener" href="https://timaksu.com/post/126337219047/spruce-up-your-custom-unity-inspectors-with-a">Spruce up your custom Unity inspectors with a preview area!</a><br><a target="_blank" rel="noopener" href="https://programming.vip/docs/unityprevieweditor-create-a-preview-window-using-previewrendertutility.html">create a preview window using previewrendertutility</a><br><a target="_blank" rel="noopener" href="https://answers.unity.com/questions/448086/is-it-possible-to-create-a-custom-model-preview-in.html">Is it possible to create a custom model preview in an Editor window akin to the one displayed when an FBX is selected?</a><br><a target="_blank" rel="noopener" href="https://forum.unity.com/threads/editorwindow-preview-of-prefab.1057988/">EditorWindow - Preview of prefab</a><br><a target="_blank" rel="noopener" href="http://zh.esotericsoftware.com/forum/How-to-correctly-draw-preview-in-EditorWindow-13046">How to correctly draw preview in EditorWindow </a><br><a target="_blank" rel="noopener" href="https://github.com/akof1314/UnityParticleSystemPreview">Unity 粒子特效预览工具</a><br><a target="_blank" rel="noopener" href="https://github.com/Yene2017">这个家伙有点牛逼</a><br><a target="_blank" rel="noopener" href="https://learn.unity.com/tutorial/introduction-to-scriptable-objects?language=en#">Introduction to Scriptable Objects</a><br><a target="_blank" rel="noopener" href="https://learn.unity.com/tutorial/creating-basic-editor-tools?language=en#">Creating Basic Editor Tools</a><br><a target="_blank" rel="noopener" href="https://learn.unity.com/tutorial/property-drawers-and-custom-inspectors?language=en">Property Drawers and Custom Inspectors</a><br><a target="_blank" rel="noopener" href="https://learn.unity.com/tutorial/creating-custom-gizmos-for-development-2019-3?language=en#">Creating Custom Gizmos for Development</a><br><a target="_blank" rel="noopener" href="https://learn.unity.com/tutorial/editor-scripting?language=en#5c7f8528edbc2a002053b5fa">Editor Scripting</a><br><a target="_blank" rel="noopener" href="https://github.com/BanMing/TextEmoji">TextEmoji</a><br><a target="_blank" rel="noopener" href="https://github.com/Dandarawy/UnityBookPageCurl">Unity3D Book Page Curl</a><br><a target="_blank" rel="noopener" href="https://github.com/yasirkula/UnityDynamicPanels">Dynamic Panels for Unity 3D</a><br><a target="_blank" rel="noopener" href="https://github.com/garsonlab/GText">GText</a><br><a target="_blank" rel="noopener" href="https://github.com/AKJ1/CruddyEditor">CruddyEditor</a><br><a target="_blank" rel="noopener" href="https://github.com/djfariel/UnityBugTracker">UnityBugTracker</a><br><a target="_blank" rel="noopener" href="https://github.com/YMD-ZhangZhang/ZZUnityEditor">ZZUnityEditor</a><br><a target="_blank" rel="noopener" href="https://github.com/ZoserLock/unity-editor-tools">Unity Editor Tools</a><br><a target="_blank" rel="noopener" href="https://github.com/Cyanilux/ToDo">ToDo</a><br><a target="_blank" rel="noopener" href="https://github.com/charcolle/UnityEditorMemo">UnityEditorMemo</a><br><a target="_blank" rel="noopener" href="https://thegamedev.guru/">BECOME A GAME PERFORMANCE EXPERT</a><br><a target="_blank" rel="noopener" href="https://mailchi.mp/3f4a331f4255/issue-3803533?e=697c40775c">Unity合集</a>：非常丰富；<br><a target="_blank" rel="noopener" href="https://github.com/baba-s/awesome-unity-open-source-on-github">Awesome Unity Open Source on GitHub (800+)</a>:一大包Unity技术合集，力荐；<br><a target="_blank" rel="noopener" href="https://github.com/sugi-cho/Animation-Texture-Baker">Animation Texture Baker for Unity</a>:动画烘焙成贴图;<br><a target="_blank" rel="noopener" href="https://weeklyhow.com/unity-custom-editor-window/">Unity Tutorials: How To Create Custom Editor Window</a>:Create Custom Editor Window;<br><a target="_blank" rel="noopener" href="https://unitylist.com/p/5c3/Unity-editor-icons">Unity Editor Built-in Icons</a>:Unity version: 2020.1.0f1 Icons what can load using EditorGUIUtility.IconContent;<br><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@7.1/manual/universalrp-asset.html">Universal Render Pipeline</a>:URP;<br><a target="_blank" rel="noopener" href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/">Intro to Shader Graph</a>:This post is a detailed introduction to using Shader Graph ;<br><a target="_blank" rel="noopener" href="https://cyangamedev.wordpress.com/2020/06/05/urp-shader-code/">Writing Shader Code for the Universal RP</a>:Writing Shader Code for the Universal RP;<br><a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/UniversalRenderingExamples">Universal Rendering Examples</a>:This project contains a collection of Custom Renderer examples. This will be updated as we refine the feature and add more options;<br><a target="_blank" rel="noopener" href="https://www.codinblack.com/the-big-shader-graph-tutorial-introduction/">The Big Shader Graph Tutorial: Introduction</a>:This is the first part of a fundamental tutorial about shader graph;<br><a target="_blank" rel="noopener" href="https://forum.unity.com/threads/urp-sampling-shadow-map-from-shader-graph.857581/">URP - Sampling Shadow Map from Shader Graph</a>:URP - Sampling Shadow Map from Shader Graph;<br><a target="_blank" rel="noopener" href="https://www.raywenderlich.com/138-introduction-to-unity-particle-systems">Introduction To Unity: Particle Systems</a>:Unity’s particle system is both robust and feature packed. In this tutorial, you’ll learn the ins-and-outs of it to create both fire and explosions;<br><a target="_blank" rel="noopener" href="https://forum.unity.com/threads/using-materialpropertyblocks-with-shadergraph-shaders-help-wanted.651547/">Using MaterialPropertyBlocks with ShaderGraph shaders</a>:Using MaterialPropertyBlocks with ShaderGraph shaders;<br><a target="_blank" rel="noopener" href="https://game-developers.org/how-to-use-terrain-with-urp-in-unity-2020-beginner-tutorial/">How to Use Terrain with URP in Unity 2020 | Beginner Tutorial</a>:How to Use Terrain with URP in Unity 2020 | Beginner Tutorial;<br><a target="_blank" rel="noopener" href="https://forum.unity.com/threads/bake-static-light-and-shadows-directly-into-texture-optimizing-for-mobile.824526/">Bake static light and shadows directly into texture ! optimizing for mobile</a>:Bake static light and shadows directly into texture ! optimizing for mobile;<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/gaming/acoustics/unity-baking">Project Acoustics Unity Bake Tutorial</a>:his article describes acoustics baking by using Project Acoustics in Unity;<br><a target="_blank" rel="noopener" href="https://support.unity.com/hc/en-us/articles/210223733-How-to-customize-Unity-script-templates">How to customize Unity script templates</a>:When I create a new script, the Unity Editor generates its content. For C# scripts it uses the file name as the class name;<br><a target="_blank" rel="noopener" href="https://github.com/joaoborks/myunitytools-script-template">Unity Tools - Script Template</a>:This tool adds custom Script Templates to Unity that will serve as alternatives for the default “C#Script” that I personally always modify before writing my scripts;<br><a target="_blank" rel="noopener" href="https://riptutorial.com/unity3d/example/14519/editor-window">Editor Window</a>:Create a basic EditorWindow;<br><a target="_blank" rel="noopener" href="https://www.synnaxium.com/en/2019/01/unity-custom-map-editor-part-1/">Unity – Creating a custom map editor</a>:make a custom map editor in Unity;<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/114371275">unity编辑器扩展之SceneUI</a>:unity编辑器扩展之SceneUI——贴在Scene View的SceneCanvas;<br><a target="_blank" rel="noopener" href="https://www.gamasutra.com/blogs/ByronMayne/20160121/258356/Code_Generation_in_Unity.php">Code Generation in Unity</a><br><a target="_blank" rel="noopener" href="https://www.arcturuscollective.com/archives/22">Compile C# at runtime in Unity3D</a><br><a target="_blank" rel="noopener" href="https://gram.gs/gramlog/creating-node-based-editor-unity/">Creating a Node Based Editor in Unity</a><br><a target="_blank" rel="noopener" href="https://needle.tools/package-reference/list/">package-reference</a>:<a target="_blank" rel="noopener" href="https://github.com/needle-mirror?q=&type=&language=&sort=">Unity Package</a><br><a target="_blank" rel="noopener" href="https://unity3d.com/get-unity/download/archive">Unity download archive</a>:Unity内置shader源码下载<br><a target="_blank" rel="noopener" href="https://github.com/tiredamage42/OpenWorldFramework#readme">OpenWorldFramework</a><br><a target="_blank" rel="noopener" href="https://github.com/ShadowLancer42/Long-Term-Open-World">Long-Term-Open-World</a><br><a target="_blank" rel="noopener" href="https://github.com/Mrchrissross/Procedural-Content-Generation">Procedural-Content-Generation</a><br><a target="_blank" rel="noopener" href="https://forum.unity.com/threads/filter-which-objects-i-can-select-in-the-scene-object-via-editor-tool-how-to-do-custom-selection.516897/">Filter which objects I can select in the scene object via editor tool</a><br><a target="_blank" rel="noopener" href="http://www.roboryantron.com/2017/10/unite-2017-game-architecture-with.html">Game Architecture with Scriptable Objects</a></p>
<h3 id="Duality"><a href="#Duality" class="headerlink" title="Duality"></a>Duality</h3><p><a target="_blank" rel="noopener" href="https://docs.duality2d.net/pages/v3/getting-started.html">Getting Started</a>:It’s an extensible 2D game engine;<br><a target="_blank" rel="noopener" href="https://hub.packtpub.com/turn-based-game-framework-duality-c/">Turn-based game framework in Duality (C#)</a>:This post presents a simple turn-based game framework using the Duality game engine;</p>
<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><h3 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/linxinfa/article/details/118816132">【游戏开发进阶】教你Unity通过Jenkins实现自动化打包，打包这种事情就交给策划了（保姆级教程 | 命令行打包 | 自动构建）</a><br><a target="_blank" rel="noopener" href="https://linxinfa.blog.csdn.net/article/details/118553713">【游戏开发进阶】教你自制离线Maven仓库，实现Unity离线环境使用Gradle打包（Unity | Android | 谷歌 | Gradle）</a><br><a target="_blank" rel="noopener" href="https://gamedevacademy.org/category/tutorials/unity-tutorials/unity-3d-tutorials/">GameDev Academy</a><br><a target="_blank" rel="noopener" href="https://www.mbsoftworks.sk/index.php?page=tutorials&series=1&tutorial=24">C++, OpenGL and more…</a>:…;<br><a target="_blank" rel="noopener" href="https://www.construct.net/en/tutorials?flang=45">GAME DEVELOPMENT TUTORIALS</a>:Read our free tutorials on game development submitted by our staff and expert users in our community;<br><a target="_blank" rel="noopener" href="https://gamasutra.com/blogs/MikeMarrone/20210312/378423/Game_Dev_Digest_Issue_85__Platforms_Performance_and_Tutorials.php">Performance optimization tips: Physics in Unity | Tutorial</a>:…;<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_30506559/article/details/125838506">【Docker闪退】【解决方法】It looks like there is an error with Docker Desktop, restart it to fix it</a></p>
<h3 id="ECS"><a href="#ECS" class="headerlink" title="ECS"></a>ECS</h3><p><a target="_blank" rel="noopener" href="https://github.com/pvigier/ecs">entity-component-system</a>:A simple and easy to use entity-component-system C++ library;</p>
<h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h3><p><a target="_blank" rel="noopener" href="http://www.angusj.com/delphi/clipper.php">Clipper - an open source freeware library</a>:The Clipper library performs line &amp; polygon clipping - intersection, union, difference &amp; exclusive-or,and line &amp; polygon offsetting. The library is based on Vatti’s clipping algorithm;<br><a target="_blank" rel="noopener" href="https://unity.stelabouras.com/">The Unity Library</a>:The Unity Library;<br><a target="_blank" rel="noopener" href="https://github.com/sideeffects/HoudiniEngineForUnity/tree/Houdini19.0">HoudiniEngineForUnity</a><br><a target="_blank" rel="noopener" href="https://www.sidefx.com/docs/unity/_getting_started.html">Houdini Engine for Unity</a></p>
<h3 id="Papers"><a href="#Papers" class="headerlink" title="Papers"></a>Papers</h3><p><a target="_blank" rel="noopener" href="https://www.highgroundgaming.com/best-turn-based-strategy-games/">10 Best Turn-Based Strategy Games in 2021 for Master Tacticians</a>:10 Best Turn-Based Strategy Games in 2021 for Master Tacticians;<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/column/88095">壹种念头Unity blog</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/266712908">收录些关于渲染相关的文章</a><br><a target="_blank" rel="noopener" href="https://www.educba.com/what-is-houdini/">What is Houdini?</a></p>
<h2 id="Bing-Map"><a href="#Bing-Map" class="headerlink" title="Bing Map"></a>Bing Map</h2><p><a target="_blank" rel="noopener" href="http://blogs.developpeur.org/nicoboo/default.aspx">MVP - Bing Maps : une année supplémentaire !</a><br><a target="_blank" rel="noopener" href="https://rbrundritt.wordpress.com/">Geocoding and Routing improvements added to Bing Maps</a></p>
<h2 id="CG-Tutorial"><a href="#CG-Tutorial" class="headerlink" title="CG Tutorial"></a>CG Tutorial</h2><p><a target="_blank" rel="noopener" href="https://docs.redshift3d.com/display/redshift3d/redshift3d+Home">redshift3d</a><br><a target="_blank" rel="noopener" href="https://www.tokeru.com/cgwiki/index.php?title=Main_Page">cgwiki</a><br><a target="_blank" rel="noopener" href="http://mattebb.com/projects/houdini/course/slides.pdf">houdini</a><br><a target="_blank" rel="noopener" href="https://mattebb.cargo.site/">cargo</a><br><a target="_blank" rel="noopener" href="https://github.com/chrisj3d/NodeFX">Authoring Particle Systems in Unity through Houdini</a><br><a target="_blank" rel="noopener" href="http://wordpress.discretization.de/houdini/home/introduction/understanding-nodes/">BASICS OF GEOMETRY NODES</a><br><a target="_blank" rel="noopener" href="https://ikrima.dev/houdini/">Houdini Guide</a><br><a target="_blank" rel="noopener" href="http://deborahrfowler.com/HoudiniResources/HOUDINI-RESOURCES.html">Houdini Resources</a><br><a target="_blank" rel="noopener" href="https://www.sidefx.com/docs/">HOUDINI DOCUMENTATION</a><br><a target="_blank" rel="noopener" href="https://www.sidefx.com/docs/houdini/">houdini docs</a><br><a target="_blank" rel="noopener" href="https://www.3dart.it/en/category/tutorial-library/houdini-tutorial/">HOUDINI TUTORIAL</a><br><a target="_blank" rel="noopener" href="http://wordpress.discretization.de/houdini/">Houdini Tech Blog</a><br><a target="_blank" rel="noopener" href="http://houdini.dreamerzstudio.net/">Houdini Render Passes</a><br><a target="_blank" rel="noopener" href="https://www.indiedb.com/games/ecotales/tutorials/houdini-unity-rigid-body-fracturing-pipeline">Houdini - Unity - Rigid Body Fracturing Pipeline</a><br><a target="_blank" rel="noopener" href="https://conceptartempire.com/houdini-tutorials/">Best Houdini Tutorials For Learning VFX &amp; Animation (Free + Premium)</a><br><a target="_blank" rel="noopener" href="https://3dtotal.com/news/general/houdini-engine-for-unity">Houdini Engine for Unity</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=STMJCA-UC_I">Creating a bones in Houdini</a><br><a target="_blank" rel="noopener" href="https://siver.artstation.com/blog?page=5">A Houdini Blog</a><br><a target="_blank" rel="noopener" href="https://ikrima.dev/houdini/basics/hou-python/">Houdini Python</a><br><a target="_blank" rel="noopener" href="https://www.andynicholas.com/post/how-to-reuse-python-code-in-a-houdini-scene">How To Reuse Python Code In A Houdini Scene</a><br><a target="_blank" rel="noopener" href="https://www.sidefx.com/media/uploads/tutorial/H11_lessons/go_pro/hguide_02_nodes.pdf">Nodes, Networks and Digital Assets</a><br><a target="_blank" rel="noopener" href="https://github.com/FofightFong/All_In_One">有关All In One 的houdini实现道路</a><br><a target="_blank" rel="noopener" href="https://jtomori.github.io/vex_tutorial/">VEX tutorial</a></p>
<h2 id="App"><a href="#App" class="headerlink" title="App"></a>App</h2><p><a target="_blank" rel="noopener" href="https://wgbqr.com/Houdini.html">胡迪尼 SideFX Houdini FX v19.0.383 破解版</a>:亲测有效<br><a target="_blank" rel="noopener" href="https://www.yutu.cn/softhtml/downsoft_6733.html">SideFX Houdini FX19【3D特效制作工具】免费破解版下载</a>:这个我并没有测试过<br><a target="_blank" rel="noopener" href="https://www.7-zip.org/download.html">7-Zip</a>一个非常好用的压缩软件<br><a target="_blank" rel="noopener" href="https://www.rejetto.com/hfs/?f=dl">hfs</a><br><a target="_blank" rel="noopener" href="https://wereturtle.github.io/ghostwriter/">Ghostwriter</a>采用MarkDown语言的免费文本编辑工具，可以实时预览编辑效果。<br><a target="_blank" rel="noopener" href="https://dillinger.io/">Dillinger</a>采用MarkDown语言的在线文本编辑工具，可以实时预览编辑效果。<br><a target="_blank" rel="noopener" href="https://www.cg.alphacodingskills.com/edit-mathjax-online.php">MathJax Online Editor</a>线上编辑数学公式。例：$$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$<br><a target="_blank" rel="noopener" href="https://www.mathjax.org/">mathjax</a>数学公式编辑软件。<br><a target="_blank" rel="noopener" href="https://www.wikihow.com/Install-FFmpeg-on-Windows">Install-FFmpeg-on-Windows</a>:ffmpeg官网好像进不了，不过这个网站的下载链接可以直接链接到官网地址，进行直接下载。<br><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase-jdk11-downloads.html">下载Java 11 下载路径</a></p>
<h2 id="Assets"><a href="#Assets" class="headerlink" title="Assets"></a>Assets</h2><p><a target="_blank" rel="noopener" href="https://www.mixamo.com/">mixamo</a>动作资源库<br><a target="_blank" rel="noopener" href="http://visionair.ge.imati.cnr.it/ontologies/shapes/viewmodels.jsp">AIM@SHAPE</a><br><a target="_blank" rel="noopener" href="https://opengameart.org/content/50-free-textures-4-normalmaps">opengameart</a><br><a target="_blank" rel="noopener" href="https://www.orbolt.com/">Create, upload, and share Houdini Digital Assets</a><br><a target="_blank" rel="noopener" href="https://www.scanslibrary.com/library?credit=0">scanslibrary</a><br><a target="_blank" rel="noopener" href="https://shadesoforange.de/blog/">Texture Synthesis Houdini</a><br><a target="_blank" rel="noopener" href="https://www.turbosquid.com/AssetManager/Downloads?stgAction=getFiles&intFileSystemId=0">turbosquid</a><br><a target="_blank" rel="noopener" href="https://www.vfxcamp.com/wp-content/themes/begin/download.php?id=Mzg3MzE=">vfxcamp</a><br><a target="_blank" rel="noopener" href="https://c4dsky.com/76397.html">3DS Max/Blender/Houdini/Modo/Maya三角面转四边形网格重拓扑插件Exoside QuadRemesher v1.01</a><br><a target="_blank" rel="noopener" href="https://www.vfxforce.cn/archives/10804">SideFX“实验室”SideFX Labs</a>没看<br><a target="_blank" rel="noopener" href="http://www.zhaotaisen.top/2020/03/25/exoside_quadremesher-%E5%9B%9B%E8%BE%B9%E5%8C%96%E6%8F%92%E4%BB%B6/">Exoside_QuadRemesher 四边化插件</a>插件下载<br><a target="_blank" rel="noopener" href="https://www.zf3d.com/Products_rj.asp?id=13698">QuadRemesh为houdini</a>付费<br><a target="_blank" rel="noopener" href="https://exoside.com/quadremesher/">Quad Remesher is available as plugins for</a>四边化插件官网，Houdini里面其实也是用他们家的</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/05/27/Line/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/05/27/Line/" class="post-title-link" itemprop="url">Line</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-27 15:01:00" itemprop="dateCreated datePublished" datetime="2021-05-27T15:01:00+08:00">2021-05-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Math/" itemprop="url" rel="index"><span itemprop="name">Math</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Math/Line/" itemprop="url" rel="index"><span itemprop="name">Line</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="线段相交"><a href="#线段相交" class="headerlink" title="线段相交"></a>线段相交</h2><p>对于平面上给定的两个线段line0、line1，求解其交点</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">LinesIntersect</span>(<span class="params">Vector2 line0_start, Vector2 line0_end, Vector2 line1_start, Vector2 line1_end, <span class="keyword">out</span> <span class="built_in">float</span> line0_cross_line1, <span class="keyword">out</span> <span class="built_in">float</span> along_line0, <span class="keyword">out</span> along_line1, <span class="keyword">out</span> Vector2 intersect_point</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> dir_line0 = line0_end - line0_start;</span><br><span class="line">	<span class="keyword">var</span> dir_line1 = line1_end - line1_start;</span><br><span class="line">	line0_cross_line1 = dir_line0.x * dir_line1.y - dir_line0.y * dir_line1.x;</span><br><span class="line">	along_line0 = <span class="number">0</span>;</span><br><span class="line">	along_line1 = <span class="number">0</span>;</span><br><span class="line">	intersect_point = Vector2.zero;</span><br><span class="line">	<span class="keyword">if</span>(line0_cross_line1 == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">var</span> dir_line_start01 = line0_start - line1_start;</span><br><span class="line">	along_line0 = (dir_line1.x * dir_line_start01.y - dir_line1.y * dir_line_start01.x) / line0_cross_line1;</span><br><span class="line">	along_line1 = (dir_line0.x * dir_line_start01.y - dir_line0.y * dir_line_start01.x) / line0_cross_line1;</span><br><span class="line">	<span class="comment">// if (along_line0 &lt; 0 || along_line0 &gt; 1 || along_line1 &lt; 0 || along_line1 &gt; 1) return false;</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相关链接：<br><a target="_blank" rel="noopener" href="https://mathopenref.com/coordintersection.html">Math Open Reference</a><br><a target="_blank" rel="noopener" href="https://sean.cm/a/polygon-clipping-pt1">Polygon Clipping</a><br><a target="_blank" rel="noopener" href="https://barendgehrels.blogspot.com/2010/12/intersections-1.html">Barend’s Blog</a><br><a target="_blank" rel="noopener" href="https://cs.stackexchange.com/questions/99927/concave-polygon-intersection-algorithm">Concave Polygon Intersection - Algorithm</a><br><a target="_blank" rel="noopener" href="https://fribbels.github.io/shortestpath/writeup.html">Euclidean Shortest Paths</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/04/06/URP_Render_Water/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/04/06/URP_Render_Water/" class="post-title-link" itemprop="url">URP Water</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-06 10:01:00" itemprop="dateCreated datePublished" datetime="2021-04-06T10:01:00+08:00">2021-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/URP/" itemprop="url" rel="index"><span itemprop="name">URP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> WaterFeature :ScriptableRendererFeature</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Settings</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> TextureName = <span class="string">&quot;_NormalGrabTexture&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> LayerMask LayerMask;</span><br><span class="line">        <span class="keyword">public</span> Material normalGrabMaterial;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> normalGrabMaterialPassIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> LayerMask WaterLayerMask;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">NormalGrabPass</span> : <span class="title">ScriptableRenderPass</span></span><br><span class="line">    &#123;</span><br><span class="line">        Settings settings;</span><br><span class="line">        Material normalGrabMaterial;</span><br><span class="line">        <span class="built_in">int</span> normalGrabMaterialPassIndex = <span class="number">0</span>;</span><br><span class="line">        RenderTargetHandle tempNormalTarget;</span><br><span class="line">        List&lt;ShaderTagId&gt; m_ShaderTagIdList = <span class="keyword">new</span> List&lt;ShaderTagId&gt;();</span><br><span class="line">        FilteringSettings m_FilteringSettings;</span><br><span class="line">        RenderStateBlock m_RenderStateBlock;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NormalGrabPass</span>(<span class="params">Settings settings</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.settings = settings;</span><br><span class="line">            normalGrabMaterial = <span class="keyword">new</span> Material(Shader.Find(<span class="string">&quot;Unlit/NormalTexture&quot;</span>));</span><br><span class="line">            normalGrabMaterialPassIndex = <span class="number">0</span>;</span><br><span class="line">            renderPassEvent = RenderPassEvent.AfterRenderingOpaques;</span><br><span class="line">            tempNormalTarget.Init(settings.TextureName);</span><br><span class="line">            m_ShaderTagIdList.Add(<span class="keyword">new</span> ShaderTagId(<span class="string">&quot;UniversalForward&quot;</span>));</span><br><span class="line">            m_ShaderTagIdList.Add(<span class="keyword">new</span> ShaderTagId(<span class="string">&quot;LightweightForward&quot;</span>));</span><br><span class="line">            m_ShaderTagIdList.Add(<span class="keyword">new</span> ShaderTagId(<span class="string">&quot;SPRDefaultUnlit&quot;</span>));</span><br><span class="line">            m_FilteringSettings = <span class="keyword">new</span> FilteringSettings(RenderQueueRange.all, settings.LayerMask);</span><br><span class="line">            m_RenderStateBlock = <span class="keyword">new</span> RenderStateBlock(RenderStateMask.Nothing);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> overide <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">CommandBuffer cmd, RenderTextureDescriptor cameraTextureDescriptor</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            cmd.GetTemporaryRT(tempNormalTarget.id, cameraTextureDescriptor);</span><br><span class="line">            cmd.SetGlobalTexture(settings.TextureName, tempNormalTarget.Identifier());</span><br><span class="line">            ConfigureTarget(tempNormalTarget.Identifier()); <span class="comment">//sceen view</span></span><br><span class="line">            cmd.SetRenderTarget(tempNormalTarget.Identifier()); <span class="comment">// game view</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> overrider <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">ScriptableRenderContext context, <span class="keyword">ref</span> RenderingData renderingData</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CommandBuffer cmd = CommandBufferPool.Get();</span><br><span class="line">            context.ExecuteCommandBuffer(cmd);</span><br><span class="line">            cmd.Clear();</span><br><span class="line">            Matrix4x4 viewMatrix = renderingData.cameraData.camera.worldToCameraMatrix;</span><br><span class="line">            Vector3 normal = viewMatrix.MultiplyVector(<span class="keyword">new</span> Vector3(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">            cmd.ClearRenderTarget(<span class="literal">false</span>, <span class="literal">true</span>, <span class="keyword">new</span> Color(normal.x, normal.y, normal.z));</span><br><span class="line">            context.ExecuteCommandBuffer(cmd);</span><br><span class="line">            cmd.Clear();</span><br><span class="line"></span><br><span class="line">            DrawingSettings drawingSettings = CreateDrawingSettings(m_ShaderTagIdList, <span class="keyword">ref</span> renderingData, SortingCriteria.CommonOpaque);</span><br><span class="line">            drawingSettings.overrideMaterial = normalGrabMaterial;</span><br><span class="line">            drawingSettings.overrideMaterialPassIndex = normalGrabMaterialPassIndex;</span><br><span class="line">            contex.DrawRenderers(renderingData.cullResults, <span class="keyword">ref</span> drawingSettings, <span class="keyword">ref</span> m_FilteringSettings, <span class="keyword">ref</span> m_RenderStateBlock);</span><br><span class="line"></span><br><span class="line">            context.ExecuteCommandBuffer(cmd);</span><br><span class="line">            CommandBufferPool.Release(cmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">FrameCleanup</span>(<span class="params">CommandBuffer cmd</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            cmd.ReleaseTemporaryRT(tempNormalTarget.id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">WaterPass</span> : <span class="title">ScriptableRenderPass</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;ShaderTagId&gt; m_ShaderTagIdList = <span class="keyword">new</span> List&lt;ShaderTagId&gt;();</span><br><span class="line">        RenderStateBlock m_RenderStateBlock;</span><br><span class="line">        FilteringSettings m_FilteringSettings;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">WaterPass</span>(<span class="params">Settings settings</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            renderPassEvent = RenderPassEvent.BeforeRenderingTransparents;</span><br><span class="line">            m_ShaderTagIdList.Add(<span class="keyword">new</span> ShaderTagId(<span class="string">&quot;Water&quot;</span>));</span><br><span class="line">            m_RenderStateBlock = <span class="keyword">new</span> RenderStateBlock(RenderStateMask.Nothing);</span><br><span class="line">            m_FilteringSettings = <span class="keyword">new</span> FilteringSettings(RenderQueueRange.transparent, settings.WaterLayerMask);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">ScriptableRenderContext context, <span class="keyword">ref</span> RenderingData renderingData</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CommandBuffer cmd = CommandBufferPool.Get();</span><br><span class="line">            context.ExecuteCommandBuffer(cmd);</span><br><span class="line">            cmd.Clear();</span><br><span class="line"></span><br><span class="line">            DrawingSettings drawingSettings = CreateDrawingSettings(m_ShaderTagIdList, <span class="keyword">ref</span> renderingData, SortingCriteria.CommonOpaque);</span><br><span class="line">            contex.DrawRenderers(renderingData.cullResults, <span class="keyword">ref</span> drawingSettings, <span class="keyword">ref</span> m_FilteringSettings, <span class="keyword">ref</span> m_RenderStateBlock);</span><br><span class="line"></span><br><span class="line">            context.ExecuteCommandBuffer(cmd);</span><br><span class="line">            CommandBufferPool.Release(cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="meta">SerializeField</span>] Settings settings = <span class="keyword">new</span> Settings();</span><br><span class="line">    NormalGrabPass normalGrabPass;</span><br><span class="line">    WaterPass waterPass;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">AddRenderPasses</span>(<span class="params">ScriptableRenderer renderer, <span class="keyword">ref</span> RenderingData renderingData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        renderer.EnqueuePass(normalGrabPass);</span><br><span class="line">        renderer.EnqueuePass(waterPass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Create</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        normalGrabPass = <span class="keyword">new</span> NormalGrabPass(settings);</span><br><span class="line">        waterPass = <span class="keyword">new</span> WaterPass(settings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/NormalTexture&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties&#123;&#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123;<span class="string">&quot;RenderType&quot;</span> = <span class="string">&quot;Opaque&quot;</span> <span class="string">&quot;RenderPipeline&quot;</span> = <span class="string">&quot;UniversalPipeline&quot;</span>&#125;</span><br><span class="line">        ZWrite Off</span><br><span class="line">        ZTest Always</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name <span class="string">&quot;NormalTexture&quot;</span></span><br><span class="line">            HLSLPROGRAM</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Corel.hlsl&quot;</span></span><br><span class="line">            <span class="keyword">struct</span> VertexInput</span><br><span class="line">            &#123;</span><br><span class="line">                float4 posotionCS : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">struct</span> FragInput</span><br><span class="line">            &#123;</span><br><span class="line">                float4 positionCS : SV_POSITION;</span><br><span class="line">                float3 normal : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="function">FragInput <span class="title">vert</span>(<span class="params">VertexInput i</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                FragInput o;</span><br><span class="line">                float3 worldPos = TransformObjectToWorld(i.positionOS.xyz);</span><br><span class="line">                float4 clipPos = TransformWorldToHClip(worldPos);</span><br><span class="line">                o.positionCS = clipPos;</span><br><span class="line">                float3 worldNormal = TransformObjectToWorldNormal(i.normal);</span><br><span class="line">                o.normal = TransformWorldToViewDir(worldNormal);</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function">half4 <span class="title">frag</span>(<span class="params">FragInput i</span>) : SV_TARGET</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> half4(i.normal, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ENDHLSL</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/ToonWater&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _DepthGradientShallow(<span class="string">&quot;Depth Gradient Shallow&quot;</span>, Color) = (<span class="number">0</span>,<span class="number">3</span>,<span class="number">0.8</span>,<span class="number">0.9</span>,<span class="number">0.4</span>)</span><br><span class="line">        _DepthGradientDeep(<span class="string">&quot;Depth Gradient Deep&quot;</span>, Color) = (<span class="number">0.08</span>, <span class="number">0.4</span>, <span class="number">0.1</span>, <span class="number">0.7</span>)</span><br><span class="line">        _DepthMaxDistance(<span class="string">&quot;Depth Maximum Distance&quot;</span>, Float) = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        _SurfaceNoise(<span class="string">&quot;Surface Noise&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line">        _SurfaceNoiseCutoff(<span class="string">&quot;Surface Noise Cutoff&quot;</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.77</span></span><br><span class="line">        _FoamColor(<span class="string">&quot;Foam Color&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _FoamMaxDistance(<span class="string">&quot;Foam Max Distance&quot;</span>, Float) = <span class="number">1</span></span><br><span class="line">        _FoamMinDistance(<span class="string">&quot;Foam Min Distance&quot;</span>, Float) = <span class="number">0.4</span></span><br><span class="line">        _SurfaceNoiseScroll(<span class="string">&quot;Surface Noise Scroll Amount&quot;</span>, Vector) = (<span class="number">0.03</span>, <span class="number">0.03</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        _SurfaceDistortion(<span class="string">&quot;Surface Distortion&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line">        _SurfaceDistortionAmount(<span class="string">&quot;Surface Distortion Amount&quot;</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.27</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span> = <span class="string">&quot;Transparent&quot;</span> <span class="string">&quot;Queue&quot;</span> = <span class="string">&quot;Transparent&quot;</span> <span class="string">&quot;RenderPipeline&quot;</span> = <span class="string">&quot;UniversalPipeline&quot;</span> &#125;</span><br><span class="line">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">        ZWrite Off</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags &#123;<span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;Water&quot;</span> &#125;</span><br><span class="line">            HLSLPROGRAM</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">define</span> SMOOTHSTEP_AA 0.01</span></span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/DeclareDepthTexture.hlsl&quot;</span></span><br><span class="line">            float4 _DepthGradientShallow;</span><br><span class="line">            float4 _DepthGradientDeep;</span><br><span class="line">            <span class="built_in">float</span> _DepthMaxDistance;</span><br><span class="line">            TEXTURE2D(_SurfaceNoise);   SAMPLER(sampler_SurfaceNoise);</span><br><span class="line">            float4 _SurfaceNoise_ST;</span><br><span class="line">            <span class="built_in">float</span> _SurfaceNoiseCutoff;</span><br><span class="line">            <span class="built_in">float</span> _FoamMaxDistance;</span><br><span class="line">            <span class="built_in">float</span> _FoamMinDistance;</span><br><span class="line">            float2 _SurfaceNoiseScroll;</span><br><span class="line">            TEXTURE2D(_SurfaceDistortion);  SAMPLER(sampler_SurfaceDistortion);</span><br><span class="line">            float4 _SurfaceDistortion_ST;</span><br><span class="line">            <span class="built_in">float</span> _SurfaceDistortionAmount;</span><br><span class="line">            TEXTURE2D(_NormalGrabTexture); SAMPLER(sampler_NormalGrabTexture);</span><br><span class="line">            float4 _FoamColor;</span><br><span class="line">            <span class="keyword">struct</span> VertexInput</span><br><span class="line">            &#123;</span><br><span class="line">                float4 positionOS : POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">struct</span> FragInput</span><br><span class="line">            &#123;</span><br><span class="line">                float4 positionCS : SV_POSITION;</span><br><span class="line">                float4 screenPos : TEXCOORD0;</span><br><span class="line">                float3 viewPos : TEXCOORD1;</span><br><span class="line">                float2 noiseUV : TEXCOORD2;</span><br><span class="line">                float2 distortUV : TEXCOORD3;</span><br><span class="line">                float3 viewNormal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="function">FragInput <span class="title">vert</span>(<span class="params">VertexInput i</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                FragInput o;</span><br><span class="line">                float3 worldPos = TransformObjectToWorld(i.positionOS.xyz);</span><br><span class="line">                float4 clipPos= TransformWorldToHClip(worldPos);</span><br><span class="line">                float4 screenPos = ConputeScreenPos(clipPos);</span><br><span class="line">                float3 viewPos = TransformWorldToView(worldPos);</span><br><span class="line">                o.positionCS = clipPos;</span><br><span class="line">                o.screenPos = screenPos;</span><br><span class="line">                o.viewPos = viewPos;</span><br><span class="line">                o.noiseUV = TRANSFORM_TEX(i.uv, _SurfaceNoise);</span><br><span class="line">                o.distortUV = TRANSORM_TEX(i.uv, _SurfaceDistortion);</span><br><span class="line">                float3 worldNormal = TransformObjectToWorldNormal(i.normal);</span><br><span class="line">                o.viewNormal = TransformWorldToViewDir(worldNormal);</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function">float4 <span class="title">AlpahBelnd</span>(<span class="params">float4 top, float4 bottom</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                float3 color = top.rgb * top.a + (<span class="number">1</span> - top.a) * bottom.rgb;</span><br><span class="line">                <span class="built_in">float</span> alpha = top.a + bottom.a * (<span class="number">1</span> - top.a);</span><br><span class="line">                <span class="keyword">return</span> float4(color, alpha);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function">half4 <span class="title">frag</span>(<span class="params">FragInput i</span>) : SV_TARGET</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                half4 color = float4(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">                float2 screenUV = i.screenPos.xy / i.screenPos.w;</span><br><span class="line">                <span class="built_in">float</span> sceeneRawDepth = SampleSceneDepth(sceenUV);</span><br><span class="line">                <span class="built_in">float</span> sceenEyeDepth = LinearEyeDepth(sceneRawDepth, _ZBufferParams);</span><br><span class="line">                <span class="built_in">float</span> depthDifference = sceneEyeDepth - i.scenePos.w;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">float</span> waterDephtDifference01 = saturate(depthDifference / _DepthMaxDistance);</span><br><span class="line">                float4 waterColor = lerp(_DepthGradientShallow, _DepthGradientDeep, waterDepthDifference01);</span><br><span class="line"></span><br><span class="line">                float2 distortSample = SAMPLE_TEXTURE2D(_SurfaceDistortion, sampler_SurfaceDistortion, i.distorUV).xy;</span><br><span class="line">                distortSample = (distortSample * <span class="number">2</span> - <span class="number">1</span>) * _SurfaceDIstortionAmount;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">float</span> noiseUV = float2(i.noiseUV.x + _Time.y * _SurfaceNoiseScroll.x,</span><br><span class="line">                                        i.noiseUV.y + _Time.y * _SurfaceNoiseScroll.y);</span><br><span class="line">                <span class="built_in">float</span> surfaceNoiseSample = SAMPLE_TEXTURE2D(_SurfaceNoise, sampler_SurfaceNoise, noiseUV);</span><br><span class="line"></span><br><span class="line">                float3 existingNormal = SAMPLE_TEXTURE2D(_NormalGrabTexture, sampler_NormalGrabTexture, screenUV).rgb;</span><br><span class="line">                <span class="built_in">float</span> normalDot = saturate(<span class="keyword">do</span>(existingNormal, i.viewNormal));</span><br><span class="line">                <span class="built_in">float</span> foamDistance = lerp(_FoamMaxDistance, _FoamMinDistance, normalDot);</span><br><span class="line">                <span class="built_in">float</span> foamDipthDifference01 = saturate(depthDifference / foamDistance);</span><br><span class="line"></span><br><span class="line">                <span class="built_in">float</span> surfaceNoiseCutoff = foamDepthDifference01 * _surfaceNoiseCutoff;</span><br><span class="line">                <span class="built_in">float</span> surfaceNoise = smoothstep(surfaceNoiseCutoff - SMOOTHSTEP_AA, surfaceNoiseCutoff + SMOOTHSTEP_AA, surfaceNoiseSample);</span><br><span class="line"></span><br><span class="line">                float4 surfaceNoiseColor = _FoamColor * surfaceNoise;</span><br><span class="line">                color = ALphaBlend(surfaceNoiseColor, waterColor);</span><br><span class="line">                <span class="keyword">return</span> color;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDHLSL</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/04/06/Unity-Editor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/04/06/Unity-Editor/" class="post-title-link" itemprop="url">Unity Editor</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-06 10:01:00" itemprop="dateCreated datePublished" datetime="2021-04-06T10:01:00+08:00">2021-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/Editor/" itemprop="url" rel="index"><span itemprop="name">Editor</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="获取当前选择的目录"><a href="#获取当前选择的目录" class="headerlink" title="获取当前选择的目录"></a>获取当前选择的目录</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetCurrentAssetDirectory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="keyword">var</span> obj <span class="keyword">in</span> Selection.GetFiltered&lt;Object&gt;(SelectionMode.Assets))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">var</span> path = AssetDataBase.GetAssetPath(obj);</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">string</span>.IsNullOrEmpty(path))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> path;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(System.IO.File.Exists(path))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> System.IO.Path.GetDirectory(path);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;Assets&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建hlsl脚本"><a href="#创建hlsl脚本" class="headerlink" title="创建hlsl脚本"></a>创建hlsl脚本</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">AssetsMenu</span></span><br><span class="line">&#123;</span><br><span class="line">	[<span class="meta">MenuItem(<span class="meta-string">&quot;Assets/Create HLSL&quot;</span>)</span>]</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateHLSL</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="comment">//string projectPath = Path.GetDirectoryName(Application.dataPath);</span></span><br><span class="line">		</span><br><span class="line">		<span class="built_in">string</span> assetPath = Path.Combine(GetCurrentAssetDirectory(), <span class="string">&quot;temp.hlsl&quot;</span>);</span><br><span class="line">		assetPath = AssetDataBase.generateuniqueAssetPath(assetPath);</span><br><span class="line">		</span><br><span class="line">		AssetDataBase.CreateAsset(<span class="keyword">new</span> TextAsset(<span class="string">&quot;--&quot;</span>, assetPath);</span><br><span class="line">		File.WriteAllText(assetPath, <span class="string">&quot;&quot;</span>); <span class="comment">// clean</span></span><br><span class="line">		</span><br><span class="line">		AssetDataBase.SaveAssets();</span><br><span class="line">		AssetDataBase.Refresh();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2021/01/30/EmmyLua-for-IntelliJ-IDEA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2021/01/30/EmmyLua-for-IntelliJ-IDEA/" class="post-title-link" itemprop="url">EmmyLua 的使用方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-30 10:38:34" itemprop="dateCreated datePublished" datetime="2021-01-30T10:38:34+08:00">2021-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Lua/" itemprop="url" rel="index"><span itemprop="name">Lua</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Lua/EmmyLua/" itemprop="url" rel="index"><span itemprop="name">EmmyLua</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>EmmyLua是Jetbrains IDE的一个插件，它提供了一套注解的语法，可以帮助IDE进行代码之间索引跳转，以及变量名称提示等功能。总而言之，EmmyLua是丰富IDE的功能，和实际的代码没有关系，IDE的跳转也只是限于注释之间。</p>
<h2 id="类的声明"><a href="#类的声明" class="headerlink" title="类的声明"></a>类的声明</h2><p>EmmyLua使用@class来模拟面向对象编程，支持继承和属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- my supper class</span><br><span class="line">---@class Transport</span><br><span class="line">local p &#x3D; Class()</span><br><span class="line"></span><br><span class="line">--- 子类</span><br><span class="line">---@class Car : Transport</span><br><span class="line">local cls &#x3D; Class(p)</span><br><span class="line">function c:test()</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--@class my_type[: parent_type] [@comment]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---@class Car : Transport @define class Car extends Transport</span><br><span class="line">local cls &#x3D; class()</span><br><span class="line">function clas:test()</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>上面定义了一个Car类，我们可以使用@type Car来表明某个变量属于Car类</p>
<h2 id="变量的声明"><a href="#变量的声明" class="headerlink" title="变量的声明"></a>变量的声明</h2><p>使用<code>@type</code>可以指明某个变量的类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---@type Car</span><br><span class="line">local car1 &#x3D; getCar()</span><br><span class="line">---@type Car</span><br><span class="line">global_car &#x3D; getCar()</span><br><span class="line">global_car:test()</span><br></pre></td></tr></table></figure>
<p>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@type my_type[|other_type] [@comment]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">---@type Car @instance of car</span><br><span class="line">local car1 &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">---@type Car|Ship @transport tools, car or ship. Since lua is dynamic-typed, a variable may be of different types</span><br><span class="line">---use | to list all possible types</span><br><span class="line">local transport &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">---@type Car @global variable type</span><br><span class="line">global_car &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">local obj &#x3D; &#123;&#125;</span><br><span class="line">---@type Car @property type</span><br><span class="line">obj.car &#x3D; getCar()</span><br></pre></td></tr></table></figure>

<h2 id="别名注释"><a href="#别名注释" class="headerlink" title="别名注释"></a>别名注释</h2><p>使用<code>@alias</code>将一些复杂不容易输入的类型注册为新的容易输入的类型<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@alias new_name type</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---@alias Handler fun( type: string, data: any):void</span><br><span class="line">---@param handler Handler</span><br><span class="line">function addHandler(handler)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><p>使用<code>@param</code>来指定函数的参数类型<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@param param_name my_type[|other_type] [@comment]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---@param car Car</span><br><span class="line">local function setCar(car)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">---@param car Car</span><br><span class="line">setCallback(function(car)</span><br><span class="line">end)</span><br><span class="line"></span><br><span class="line">---@param car Car</span><br><span class="line">for k, car in pairs(list) do</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="函数返回值类型说明"><a href="#函数返回值类型说明" class="headerlink" title="函数返回值类型说明"></a>函数返回值类型说明</h2><p>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@return my_type[|other_type] [@comment]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---@return Car|Ship</span><br><span class="line">local function crate()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">---here car_or_ship doesn&#39;t need @type annotation, EmmyLua has already inferred the type via &quot;create&quot; function</span><br><span class="line">local car_or_ship &#x3D; create()</span><br><span class="line"></span><br><span class="line">---@return Car</span><br><span class="line">function factory:create()</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="属性声明"><a href="#属性声明" class="headerlink" title="属性声明"></a>属性声明</h2><p>使用<code>@field</code>可以标明类所具有的属性，即使类中没有使用到这个属性<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@field [public|protected|private] field_name field_type[|other_type] [@comment]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---@class Car</span><br><span class="line">---@field public name string @add name field to class Car, you&#39;ll see it in code completion</span><br><span class="line">local cls &#x3D; class()</span><br></pre></td></tr></table></figure>

<h2 id="泛型声明"><a href="#泛型声明" class="headerlink" title="泛型声明"></a>泛型声明</h2><p>使用<code>@generic</code>来模拟一些高级语言的泛型<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@generic T1 [: parent_type] [, T2 [: parent_type]]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---@generic T : Transport, K</span><br><span class="line">---@param param1 T</span><br><span class="line">---@param param2 K</span><br><span class="line">---@return T</span><br><span class="line">local function test(param1, param2)</span><br><span class="line">	-- todo</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">---@type Car</span><br><span class="line">local car &#x3D; ...</span><br><span class="line">local value &#x3D; test(car)</span><br></pre></td></tr></table></figure>
<p>这里说明一下，上面的<code>T</code>和<code>K</code>都是类型，只不过<code>T</code>是继承自<code>Transport</code>的一种类型，而<code>K</code>可以是任何类型。<br>然后<code>param1</code>是类型<code>T</code>的实例</p>
<h2 id="不定参数的注释"><a href="#不定参数的注释" class="headerlink" title="不定参数的注释"></a>不定参数的注释</h2><p>使用<code>@vararg</code>注解函数不定参数部分<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@vararg type</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---@vararg string</span><br><span class="line">---@return string</span><br><span class="line">local function format(...)</span><br><span class="line">	local tbl &#x3D; &#123;...&#125; --inferred as string[]</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="嵌入其他语言"><a href="#嵌入其他语言" class="headerlink" title="嵌入其他语言"></a>嵌入其他语言</h2><p>使用<code>@language</code>可以在lua代码中嵌入其他语言<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@language language_id</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---@language JSON</span><br><span class="line">local jsonText &#x3D; [[&#123;</span><br><span class="line">	&quot;name&quot;:&quot;Emmy&quot;</span><br><span class="line">	&#125;]]</span><br></pre></td></tr></table></figure>

<h2 id="数组类型声明"><a href="#数组类型声明" class="headerlink" title="数组类型声明"></a>数组类型声明</h2><p>使用<code>@type mytype[]</code>可以指定变量类型为数组<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@type my_type[]</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---@type Car[]</span><br><span class="line">local list &#x3D; &#123;&#125;</span><br><span class="line">local car &#x3D; list[1]</span><br><span class="line">-- car, and you &#39;ll see completion</span><br><span class="line"></span><br><span class="line">for i, car in pairs(list) do</span><br><span class="line">	-- car. and you&#39;ll see completion</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="table类型声明"><a href="#table类型声明" class="headerlink" title="table类型声明"></a>table类型声明</h2><p>使用<code>@type table</code>可以表示某变量为表格类型<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@type table&lt;key_type, value_type&gt;</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---@type table&lt;string, Car&gt;</span><br><span class="line">local dict &#x3D; &#123;&#125;</span><br><span class="line">local car &#x3D; dict[&#39;key&#39;]</span><br><span class="line">-- car. and you&#39;ll see completion</span><br><span class="line">for key, car in pairs(dict) do</span><br><span class="line">	-- car. and you&#39;ll see completion</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h2><p>使用<code>fun(param:my_type):return_type</code>来表示函数类型变量<br>其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---@type fun(param:my_type):return_type</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@type fun(key:string):Car</span><br><span class="line">local carCreatorFn1</span><br><span class="line"></span><br><span class="line">local car &#x3D; carCreatorFn1(&#39;key&#39;)</span><br><span class="line">-- car. and you see code completion</span><br><span class="line"></span><br><span class="line">---@type fun():Car[]</span><br><span class="line">local carCreatorFn2</span><br><span class="line"></span><br><span class="line">for i, car in pairs(carCreatorFn2()) do</span><br><span class="line">	-- car. and you see completion</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="字面常量类型声明"><a href="#字面常量类型声明" class="headerlink" title="字面常量类型声明"></a>字面常量类型声明</h2><p>字面常量也可以指定特定字符串来作为代码提示，结合别名，可以起到类似于枚举的效果<br>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---@alias Handler fun(type: string, data: any): void</span><br><span class="line"></span><br><span class="line">---@param event string | &quot;&#39;onClised&#39;&quot; | &quot;&#39;onData&#39;&quot;</span><br><span class="line">---@param handler Handler | &quot;function(type, data) print(data) end&quot;</span><br><span class="line">function addEventListener(event, handler)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>上面的写法还是比较复杂，我们可以用<code>@alias</code>再简化一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---@alias Handler fun(type: string, data: any): void</span><br><span class="line">---@alias IOEventEnum string | &quot;&#39;onClised&#39;&quot; | &quot;&#39;onData&#39;&quot;</span><br><span class="line">---@param event IOEventEnum</span><br><span class="line">---@param handler Handler | &quot;function(type, data) print(data) end&quot;</span><br><span class="line">function addEventListener(event, handler)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2020/12/23/Joy-Stick-Function-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2020/12/23/Joy-Stick-Function-2/" class="post-title-link" itemprop="url">摇杆实现方法2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-23 22:02:00" itemprop="dateCreated datePublished" datetime="2020-12-23T22:02:00+08:00">2020-12-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/Component/" itemprop="url" rel="index"><span itemprop="name">Component</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>自己做了个飞行模拟的小游戏，发布到手机上需要用到摇杆来控制。原先是通过一个Joystick类来实现，摇杆位置固定，详细请参考<a href="https://tyson-wu.github.io/blogs/2020/12/23/Joy-Stick-Function/">这里</a><br>但是后面策划说要做成王者荣耀那种，摇杆的位置会根据手指的位置有一定的活动区域，所以我重新写了一份逻辑，并且对代码进行一定的逻辑细分，效果如下：<br><img src="/blogs/images/src/ezgif.com-gif-maker-2.gif" alt="wwwwwww"></p>
<p>首先，我这里将摇杆分为几个部分：</p>
<ul>
<li>摇杆可触发区域，紫色区域，当手指放在该区域时，可以操控摇杆</li>
<li>摇杆中心位置可活动区域，黄色区域，绿色的圆形摇杆背景图的中心点可到达的区域</li>
<li>最后是白色的摇杆和绿色摇杆背景的组合</li>
</ul>
<p>前两个都挂载了一个区域判断的类-<code>TriggerAreaHandler</code>，主要用来判断屏幕点是否在该区域内，如图所示：<br><img src="/blogs/images/src/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201223224837.png" alt="wwwwwww"><br>详细代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 用于UI区域判定</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TriggerAreaHandler</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    RectTransform[] _triggerArea = <span class="literal">null</span>;<span class="comment">//触发区域</span></span><br><span class="line">    Camera _camera = <span class="literal">null</span>;<span class="comment">//画布摄像机</span></span><br><span class="line">    Canvas _canvas = <span class="literal">null</span>;<span class="comment">//画布</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InitTriggerArea</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;<span class="comment">//初始化区域</span></span><br><span class="line">        <span class="keyword">if</span> (_triggerArea != <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        _triggerArea = GetComponentsInChildren&lt;RectTransform&gt;();</span><br><span class="line">        _canvas = GetComponentInParent&lt;Canvas&gt;();</span><br><span class="line">        _camera = _canvas.worldCamera;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 计算屏幕区域是否在当前区域内</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;screenPos&quot;&gt;</span>屏幕坐标<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">CheckScreenPosInArea</span>(<span class="params">Vector2 screenPos</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        InitTriggerArea();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>;i&lt; _triggerArea.Length;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (RectTransformUtility.RectangleContainsScreenPoint(_triggerArea[i], screenPos, _camera))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 将屏幕点夹紧到该区域</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;screenPos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector2 <span class="title">Clamp</span>(<span class="params">Vector2 screenPos</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        InitTriggerArea();</span><br><span class="line">        Vector2 clampPos = _camera.WorldToScreenPoint(_triggerArea[<span class="number">0</span>].position);</span><br><span class="line">        <span class="built_in">float</span> len = <span class="built_in">float</span>.MaxValue;</span><br><span class="line">        InitTriggerArea();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; _triggerArea.Length; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            RectTransform rectTransform = _triggerArea[i];</span><br><span class="line">            <span class="keyword">if</span> (RectTransformUtility.RectangleContainsScreenPoint(_triggerArea[i], screenPos, _camera))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> screenPos;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                Vector2 rectPos = _camera.WorldToScreenPoint(rectTransform.position);</span><br><span class="line">                Rect rect = RectTransformUtility.PixelAdjustRect(rectTransform, _canvas);</span><br><span class="line">                Vector2 clampPos_temp = Clamp(screenPos, rectPos, <span class="keyword">new</span> Vector2(rect.width/<span class="number">2</span>, rect.height/<span class="number">2</span>));</span><br><span class="line">                <span class="built_in">float</span> distance = (clampPos_temp - screenPos).sqrMagnitude;</span><br><span class="line">                <span class="keyword">if</span> (distance &lt; len)</span><br><span class="line">                &#123;</span><br><span class="line">                    len = distance;</span><br><span class="line">                    clampPos = clampPos_temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> clampPos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Vector2 <span class="title">Clamp</span>(<span class="params">Vector2 <span class="keyword">value</span>,Vector2 center, Vector2 halfSize</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vector2(Clamp(<span class="keyword">value</span>.x, center.x - halfSize.x, center.x + halfSize.x),</span><br><span class="line">            Clamp(<span class="keyword">value</span>.y, center.y - halfSize.y, center.y + halfSize.y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="built_in">float</span> <span class="title">Clamp</span>(<span class="params"><span class="built_in">float</span> <span class="keyword">value</span>, <span class="built_in">float</span> min, <span class="built_in">float</span> max</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">value</span> = <span class="keyword">value</span> &gt; min ? <span class="keyword">value</span> : min;</span><br><span class="line">        <span class="keyword">value</span> = <span class="keyword">value</span> &lt; max ? <span class="keyword">value</span> : max;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三部分的摇杆组合，主要是用来显示的，所以下面挂载了一个控制其显示的脚本-<code>JoyStickView</code>，该脚本控制摇杆组合的位置显示，如图所示：<br><img src="/blogs/images/src/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201223225034.png" alt="wwwwwww"><br>代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 控制摇杆显示</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JoyStickView</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>] RectTransform _joyStickCenter;<span class="comment">//摇杆的端点</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] RectTransform _joyStickOutline;<span class="comment">//摇杆端点区域背景,设置为摇杆端点的父节点</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="built_in">float</span> _joyStickAreaScale = <span class="number">1</span>;<span class="comment">//在背景区域的基础上进行缩放，得到一个活动区域</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> _initSize = <span class="literal">false</span>;</span><br><span class="line">    Canvas _canvas = <span class="literal">null</span>;</span><br><span class="line">    Vector3 _joyStickOriginScreenPos0 = Vector3.zero; <span class="comment">//摇杆初始原点</span></span><br><span class="line">    Vector3 _joyStickOriginScreenPos = Vector3.zero; <span class="comment">//摇杆原点</span></span><br><span class="line">    <span class="built_in">float</span> _joyStickRadius = <span class="number">0</span>;<span class="comment">//摇杆真实的屏幕活动半径</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取摇杆屏幕活动半径</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">float</span> <span class="title">GetJoyStickRadius</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> _joyStickRadius;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 计算背景区域的屏幕尺寸</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 在所有函数之前调用</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CalculateAreaSize</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_initSize) <span class="keyword">return</span>; </span><br><span class="line">        _initSize = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(_canvas==<span class="literal">null</span>)  _canvas = GetComponentInParent&lt;Canvas&gt;();</span><br><span class="line">        _joyStickOriginScreenPos0 = _canvas.worldCamera.WorldToScreenPoint(_joyStickOutline.position);</span><br><span class="line">        _joyStickOriginScreenPos = _joyStickOriginScreenPos0;</span><br><span class="line">        SetJoyStickOriginPos(_joyStickOriginScreenPos0);</span><br><span class="line">        Rect rect = RectTransformUtility.PixelAdjustRect(_joyStickOutline, _canvas);</span><br><span class="line">        _joyStickRadius = _joyStickAreaScale * rect.width / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 重置摇杆原点为初始原点</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>摇杆中心点在屏幕上的位置<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector2 <span class="title">ResetJoyStickOrigionPos</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SetJoyStickOriginPos(_joyStickOriginScreenPos0);</span><br><span class="line">        <span class="keyword">return</span> _joyStickOriginScreenPos0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置整个摇杆的位置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;screenPos&quot;&gt;</span>屏幕坐标<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetJoyStickOriginPos</span>(<span class="params">Vector3 screenPos</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _joyStickOriginScreenPos.x = screenPos.x;</span><br><span class="line">        _joyStickOriginScreenPos.y = screenPos.y;</span><br><span class="line">        _joyStickOutline.position = _canvas.worldCamera.ScreenToWorldPoint(_joyStickOriginScreenPos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 基于偏移向量，设置摇杆显示位置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;dir&quot;&gt;</span>移动向量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetJoyStick</span>(<span class="params">Vector2 dir</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 dir3 = dir.sqrMagnitude &gt; <span class="number">1</span> ? dir.normalized : dir;</span><br><span class="line">        Vector3 joyStickScreenPos = dir3 * _joyStickRadius + _joyStickOriginScreenPos;</span><br><span class="line">        _joyStickCenter.position = _canvas.worldCamera.ScreenToWorldPoint(joyStickScreenPos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 判断屏幕坐标是否在摇杆触发区域里</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;screenPos&quot;&gt;</span>屏幕坐标<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">InJoyStickArea</span>(<span class="params">Vector2 screenPos</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">float</span> len = Vector2.Distance(screenPos, _joyStickOriginScreenPos);</span><br><span class="line">        <span class="keyword">return</span>  len &lt; _joyStickRadius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后是整个摇杆逻辑实现部分-<code>JoyStickTrigger</code>，这个类里面记录了触发事件，以及对外的参数，如图所示：<br><img src="/blogs/images/src/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201223223000.png"><br>同样的，通过属性器可以获取当前摇杆的状态参数，包括偏移方向以及强度，方向是360度，强度是[0-1]。详细代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 摇杆控制模块</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JoyStickTrigger</span> : <span class="title">MonoBehaviour</span>, <span class="title">IPointerDownHandler</span>, <span class="title">IPointerUpHandler</span>, <span class="title">IDragHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JoyStickTrigger instance;</span><br><span class="line">    [<span class="meta">SerializeField</span>] TriggerAreaHandler _joyStickCenterArea;<span class="comment">//摇杆背景中心点活动区域</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] TriggerAreaHandler _joyStickTriggerArea;<span class="comment">//可激活摇杆的区域</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] JoyStickView _joyStick;<span class="comment">//摇杆</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="built_in">float</span> _sensitivity = <span class="number">1</span>;<span class="comment">//摇杆灵敏度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="built_in">float</span> _triggerAreaScale = <span class="number">1</span>;<span class="comment">//摇杆控制区域</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆偏移方向</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Vector2 MoveDir &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆偏移长度[0-1]</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> MoveLen &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 是否在操控摇杆</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsDraging &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> _onJoyStickActive; &#125; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆横向偏移量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> Horizontal &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> MoveDir.x * MoveLen; &#125; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆纵向偏移量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> Vertical &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> MoveDir.y * MoveLen; &#125; &#125;</span><br><span class="line"></span><br><span class="line">    Vector2 _originScreenPos = Vector2.zero;<span class="comment">//激活摇杆的手指点击位置</span></span><br><span class="line">    Vector2 _dragScreenPos = Vector2.zero;<span class="comment">//实时拖动手指位置</span></span><br><span class="line">    Vector2 _interpolateScreenPos = Vector2.zero;<span class="comment">//实时摇杆位置</span></span><br><span class="line">    <span class="built_in">bool</span> _onJoyStickActive = <span class="literal">false</span>;<span class="comment">//摇杆是否激活</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        instance = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _joyStick.CalculateAreaSize();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        OnPointerUp(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerDown</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_joyStickTriggerArea.CheckScreenPosInArea(eventData.position))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        _onJoyStickActive = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//_originScreenPos = eventData.position;</span></span><br><span class="line">        _originScreenPos = _joyStickCenterArea.Clamp(eventData.position);</span><br><span class="line">        _interpolateScreenPos = _dragScreenPos = eventData.position;</span><br><span class="line">        _joyStick.SetJoyStickOriginPos(_originScreenPos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDrag</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_onJoyStickActive) <span class="keyword">return</span>;</span><br><span class="line">        _dragScreenPos = eventData.position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerUp</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _onJoyStickActive = <span class="literal">false</span>;</span><br><span class="line">        _dragScreenPos = _joyStick.ResetJoyStickOrigionPos();<span class="comment">//手指位置归于原点</span></span><br><span class="line">        <span class="comment">//_interpolateScreenPos += _dragScreenPos - _originScreenPos;//将插值点随摇杆位置一起归位</span></span><br><span class="line">        _interpolateScreenPos = _dragScreenPos;<span class="comment">//</span></span><br><span class="line">        _originScreenPos = _dragScreenPos;<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _interpolateScreenPos = Vector2.Lerp(_interpolateScreenPos, _dragScreenPos, Time.deltaTime * _sensitivity);</span><br><span class="line">        Vector2 dir = _interpolateScreenPos - _originScreenPos;</span><br><span class="line">        dir /= _joyStick.GetJoyStickRadius();</span><br><span class="line">        dir = dir.sqrMagnitude &gt; <span class="number">1</span> ? dir.normalized : dir;</span><br><span class="line">        MoveDir = dir;</span><br><span class="line">        MoveLen = dir.magnitude;</span><br><span class="line">        _joyStick.SetJoyStick(dir);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tyson-wu.github.io/blogs/2020/12/23/Joy-Stick-Function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blogs/images/avatar.png">
      <meta itemprop="name" content="Tyson Wu">
      <meta itemprop="description" content="If you want, Just do it!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TysonWu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blogs/2020/12/23/Joy-Stick-Function/" class="post-title-link" itemprop="url">摇杆实现方法1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-23 22:01:00" itemprop="dateCreated datePublished" datetime="2020-12-23T22:01:00+08:00">2020-12-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-07 19:12:17" itemprop="dateModified" datetime="2022-12-07T19:12:17+08:00">2022-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blogs/categories/Unity/Component/" itemprop="url" rel="index"><span itemprop="name">Component</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/blogs/images/src/ezgif.com-gif-maker-1.gif" alt="wwwwwww"><br>自己做了个飞行模拟的小游戏，发布到手机上需要用到摇杆来控制，所以自己写了一个Joystick类，代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> UGUI游戏摇杆</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Joystick</span> : <span class="title">MonoBehaviour</span>, <span class="title">IPointerDownHandler</span>, <span class="title">IPointerUpHandler</span>, <span class="title">IDragHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Joystick instance;</span><br><span class="line">    [<span class="meta">SerializeField</span>] Camera uiCamera;<span class="comment">//摇杆对应的ui摄像机</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] RectTransform _triggerArea;<span class="comment">//触发启动摇杆区域</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] RectTransform _joyStickArea;<span class="comment">//摇杆活动区域</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] RectTransform centerTrans;<span class="comment">//摇杆图标</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="built_in">float</span> sensitivity = <span class="number">1</span>;<span class="comment">//摇杆灵敏度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="built_in">float</span> triggerAreaScale = <span class="number">1</span>;<span class="comment">//摇杆控制区域</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆偏移方向</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Vector2 moveDir &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆偏移长度[0-1]</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> moveLen &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 是否在操控摇杆</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> isDraging &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆横向偏移量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> Horizontal &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> moveDir.x * moveLen; &#125; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摇杆纵向偏移量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> Vertical &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> moveDir.y * moveLen; &#125; &#125;</span><br><span class="line"></span><br><span class="line">    Canvas _canvas;</span><br><span class="line">    Canvas canvas &#123; <span class="keyword">get</span> &#123; <span class="keyword">if</span> (_canvas == <span class="literal">null</span>) _canvas = transform.GetComponentInParent&lt;Canvas&gt;(); <span class="keyword">return</span> _canvas; &#125; &#125;</span><br><span class="line">    Vector3 targetScreenPointPos = Vector3.zero;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> radius = <span class="number">0f</span>;</span><br><span class="line">    Vector3 centerScreenPos;</span><br><span class="line">    <span class="built_in">float</span> depth &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> centerScreenPos.z; &#125; &#125;</span><br><span class="line">    <span class="built_in">bool</span> hasInit = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Action onJoyStickPointerUp;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        instance = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        InitParam();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        isDraging = <span class="literal">false</span>;</span><br><span class="line">        targetScreenPointPos = centerScreenPos;</span><br><span class="line">        centerTrans.localPosition = Vector3.zero;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InitParam</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasInit) <span class="keyword">return</span>;</span><br><span class="line">        hasInit = <span class="literal">true</span>;</span><br><span class="line">        centerScreenPos = uiCamera.WorldToScreenPoint(_joyStickArea.position);</span><br><span class="line">        Rect rect = RectTransformUtility.PixelAdjustRect(_joyStickArea, canvas);</span><br><span class="line">        radius = triggerAreaScale * rect.width/<span class="number">2</span>;</span><br><span class="line">        targetScreenPointPos = centerScreenPos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerDown</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        InitParam();</span><br><span class="line">        Vector2 pointScreenPos = eventData.position;</span><br><span class="line">        <span class="comment">//if (Vector2.Distance(pointScreenPos, centerScreenPos) &gt; radius) return;</span></span><br><span class="line"></span><br><span class="line">        isDraging = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//targetScreenPointPos = uiCamera.WorldToScreenPoint(eventData.pointerCurrentRaycast.worldPosition);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDrag</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isDraging) <span class="keyword">return</span>;</span><br><span class="line">        Vector3 pointScreenPos = eventData.position;</span><br><span class="line">        pointScreenPos.z = depth;</span><br><span class="line">        Vector3 dir = pointScreenPos - centerScreenPos;</span><br><span class="line">        <span class="built_in">float</span> len = dir.magnitude;</span><br><span class="line">        len = len &gt; radius ? radius : len;</span><br><span class="line">        dir = len * dir.normalized;</span><br><span class="line">        targetScreenPointPos = centerScreenPos + dir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerUp</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        isDraging = <span class="literal">false</span>;</span><br><span class="line">        targetScreenPointPos = centerScreenPos;</span><br><span class="line">        onJoyStickPointerUp?.Invoke();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 screenPointPos = uiCamera.WorldToScreenPoint(centerTrans.position);</span><br><span class="line">        <span class="keyword">if</span>(Vector3.Distance(screenPointPos, targetScreenPointPos)&lt;<span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            screenPointPos = targetScreenPointPos;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            screenPointPos = Vector3.Lerp(screenPointPos, targetScreenPointPos, sensitivity * Time.deltaTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        centerTrans.position = uiCamera.ScreenToWorldPoint(screenPointPos);</span><br><span class="line">        moveDir = screenPointPos - centerScreenPos;</span><br><span class="line">        moveDir /= radius;</span><br><span class="line">        moveLen = moveDir.magnitude;</span><br><span class="line">        moveLen = moveLen &gt; <span class="number">1</span> ? <span class="number">1</span> : moveLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过属性器可以获取当前摇杆的状态参数，包括偏移方向以及强度，方向是360度，强度是[0-1]。还有几个<code>SerializeField</code>面板设置参数，结构如下图：<br><img src="/blogs/images/src/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201223220715.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blogs/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blogs/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blogs/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/blogs/page/7/">7</a><a class="extend next" rel="next" href="/blogs/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tyson Wu"
      src="/blogs/images/avatar.png">
  <p class="site-author-name" itemprop="name">Tyson Wu</p>
  <div class="site-description" itemprop="description">If you want, Just do it!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blogs/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blogs/categories/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blogs/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Tyson-Wu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Tyson-Wu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/zhao-wu-zhu-43" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;zhao-wu-zhu-43" rel="noopener" target="_blank"><i class="知乎 fa-fw"></i>知乎</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/Hi-blog/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;Hi-blog&#x2F;" rel="noopener" target="_blank">starnight_cyber</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tyson Wu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blogs/lib/anime.min.js"></script>
  <script src="/blogs/lib/velocity/velocity.min.js"></script>
  <script src="/blogs/lib/velocity/velocity.ui.min.js"></script>

<script src="/blogs/js/utils.js"></script>

<script src="/blogs/js/motion.js"></script>


<script src="/blogs/js/schemes/pisces.js"></script>


<script src="/blogs/js/next-boot.js"></script>




  















  

  

</body>
</html>
